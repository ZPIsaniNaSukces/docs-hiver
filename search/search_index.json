{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"architecture/components/","title":"Component Diagram","text":"<p>The component diagram zooms into the backend container to show the internal structure and how components interact.</p>"},{"location":"architecture/components/#diagram","title":"Diagram","text":"C4Component     title Component Diagram for HiveR Backend      Container_Boundary(backend, \"Backend Container\") {         Component(main, \"Main Service\", \"NestJS\", \"Handles user management, authentication, and orchestration\")         Component(presence, \"Presence Service\", \"NestJS\", \"Manages presence tracking\")         Component(tasks, \"Tasks Service\", \"NestJS\", \"Manages task workflows\")         Component(bus, \"Message Bus\", \"Kafka\", \"Event streaming platform\")          ComponentDb(mainDb, \"Main Database\", \"PostgreSQL\", \"User and company data\")         ComponentDb(presenceDb, \"Presence Database\", \"PostgreSQL\", \"Presence records\")         ComponentDb(tasksDb, \"Tasks Database\", \"PostgreSQL\", \"Task data\")     }      Container_Ext(mobile, \"Mobile App\", \"Mobile Application\")     Container_Ext(webapp, \"Web App\", \"Web Application\")     System_Ext(sns, \"AWS SNS\", \"Notifications\")      Rel(webapp, main, \"Sends events to\")     Rel(mobile, main, \"Sends requests to\")      Rel(main, mainDb, \"Reads/Writes\")     Rel(main, bus, \"Publishes events\")     Rel(main, sns, \"Sends notifications\")      Rel(bus, presence, \"Delivers presence events\")     Rel(bus, tasks, \"Delivers task events\")      Rel(presence, presenceDb, \"Writes presence data\")     Rel(presence, bus, \"Publishes events\")      Rel(tasks, tasksDb, \"Writes task data\")     Rel(tasks, bus, \"Publishes events\")      UpdateLayoutConfig($c4ShapeInRow=\"2\", $c4BoundaryInRow=\"1\")"},{"location":"architecture/components/#backend-components","title":"Backend Components","text":""},{"location":"architecture/components/#main-service","title":"Main Service","text":"<p>Technology: NestJS</p> <p>The main service is responsible for: - User authentication and authorization - Core business logic orchestration - Event publishing to the message bus - Database operations for user and company data</p> <p>Connections: - Writes to Main Database - Publishes events to the Message Bus - Receives requests from the Web App</p>"},{"location":"architecture/components/#presence-microservice","title":"Presence Microservice","text":"<p>Technology: NestJS</p> <p>Specialized service for presence tracking: - Processes presence check-in/check-out events - Maintains presence history - Generates presence reports</p> <p>Connections: - Subscribes to events from the Message Bus - Writes presence data to Presence Database</p>"},{"location":"architecture/components/#tasks-microservice","title":"Tasks Microservice","text":"<p>Technology: NestJS</p> <p>Dedicated service for task management: - Creates and updates tasks - Assigns tasks to employees - Tracks task completion status</p> <p>Connections: - Subscribes to events from the Message Bus - Writes task data to Tasks Database</p>"},{"location":"architecture/components/#message-bus-kafka","title":"Message Bus (Kafka)","text":"<p>Technology: Apache Kafka</p> <p>Central event bus providing: - Asynchronous communication between services - Event persistence and replay capability - Scalable message distribution</p> <p>Event Types: - User events (created, updated) - Presence events (check-in, check-out) - Task events (created, assigned, completed) - Notification events</p>"},{"location":"architecture/components/#databases","title":"Databases","text":"<p>Each service has its own PostgreSQL database following the database-per-service pattern:</p> <p>Main Database: Users, companies, authentication data</p> <p>Presence Database: Check-in records, presence history, schedules</p> <p>Tasks Database: Tasks, assignments, status tracking</p>"},{"location":"architecture/components/#component-interaction-flow","title":"Component Interaction Flow","text":""},{"location":"architecture/components/#example-employee-check-in","title":"Example: Employee Check-In","text":"<ol> <li>Employee uses mobile app to check in</li> <li>Request goes to Main Service</li> <li>Main Service validates and publishes <code>presence.checkin</code> event to Kafka</li> <li>Presence Microservice consumes the event</li> <li>Presence data is stored in Presence Database</li> <li>Notification event is published to AWS SNS</li> <li>Employee receives confirmation notification</li> </ol>"},{"location":"architecture/components/#example-task-assignment","title":"Example: Task Assignment","text":"<ol> <li>Manager creates task in web app</li> <li>Web app sends request to Main Service</li> <li>Main Service publishes <code>task.created</code> event to Kafka</li> <li>Tasks Microservice consumes the event</li> <li>Task is stored in Tasks Database</li> <li>Notification event triggers email to assigned employee</li> </ol> <p>Return to: Architecture Overview</p>"},{"location":"architecture/containers/","title":"Container Diagram","text":"<p>The container diagram shows the high-level technology choices and how the major pieces of the HiveR system communicate.</p>"},{"location":"architecture/containers/#diagram","title":"Diagram","text":"C4Container     title Container Diagram for HiveR      Person(employee, \"Employee\", \"A registered employee\")     Person(manager, \"Manager\", \"A manager\")     Person(admin, \"Admin\", \"Company owner\")      System_Ext(iot, \"IoT Devices\", \"IoT beacons\")     System_Ext(sns, \"AWS SNS\", \"Notifications\")      Container_Boundary(hiver, \"HiveR System\") {         Container(mobile, \"Mobile App\", \"Mobile Application\", \"Employee-facing mobile app\")         Container(webapp, \"Web App\", \"Web Application\", \"Management interface for managers and admins\")          Container_Boundary(backend, \"Backend Services\") {             Container(main, \"Main Service\", \"NestJS\", \"Core service handling user management and orchestration\")             Container(presence, \"Presence Service\", \"NestJS\", \"Manages employee presence tracking\")             Container(tasks, \"Tasks Service\", \"NestJS\", \"Handles task management workflows\")             Container(bus, \"Message Bus\", \"Kafka\", \"Event bus for async communication\")              ContainerDb(mainDb, \"Main Database\", \"PostgreSQL\", \"Stores user and company data\")             ContainerDb(presenceDb, \"Presence Database\", \"PostgreSQL\", \"Stores presence records\")             ContainerDb(tasksDb, \"Tasks Database\", \"PostgreSQL\", \"Stores task data\")         }     }      Rel(employee, mobile, \"Uses\")     Rel(manager, webapp, \"Manages workforce using\")     Rel(admin, webapp, \"Administrates using\")      Rel(mobile, iot, \"Prompts\")     Rel(iot, mobile, \"Responds\")      Rel(mobile, main, \"Sends requests to\")     Rel(webapp, main, \"Sends events to\")      Rel(main, bus, \"Publishes events to\")     Rel(main, mainDb, \"Reads from and writes to\")      Rel(bus, presence, \"Delivers events to\")     Rel(bus, tasks, \"Delivers events to\")      Rel(presence, presenceDb, \"Writes to\")     Rel(tasks, tasksDb, \"Writes to\")      Rel(main, sns, \"Sends notifications via\")     Rel(sns, employee, \"Sends push notifications to\")      UpdateLayoutConfig($c4ShapeInRow=\"3\", $c4BoundaryInRow=\"1\")"},{"location":"architecture/containers/#containers","title":"Containers","text":""},{"location":"architecture/containers/#backend","title":"Backend","text":"<p>The backend is composed of multiple microservices and shared infrastructure:</p> <ul> <li>Main Service (NestJS): Core service handling user management and orchestration</li> <li>Presence Microservice (NestJS): Manages employee presence tracking</li> <li>Tasks Microservice (NestJS): Handles task management workflows</li> <li>Message Bus (Kafka): Event bus for asynchronous communication</li> <li>Main Database (PostgreSQL): Stores user data and core system information</li> <li>Presence Database (PostgreSQL): Stores presence records</li> <li>Tasks Database (PostgreSQL): Stores task data</li> </ul>"},{"location":"architecture/containers/#mobile-app","title":"Mobile App","text":"<p>Employee-facing mobile application that: - Connects to the backend services - Interacts with IoT devices - Receives push notifications</p>"},{"location":"architecture/containers/#web-app","title":"Web App","text":"<p>Browser-based application for managers and administrators that: - Provides management interface - Connects to the main backend service - Sends events through the system</p>"},{"location":"architecture/containers/#communication-patterns","title":"Communication Patterns","text":""},{"location":"architecture/containers/#synchronous","title":"Synchronous","text":"<ul> <li>Mobile app \u2192 Backend (REST/GraphQL)</li> <li>Web app \u2192 Main Service (REST/GraphQL)</li> </ul>"},{"location":"architecture/containers/#asynchronous-event-driven","title":"Asynchronous (Event-Driven)","text":"<ul> <li>Main Service \u2192 Message Bus \u2192 Microservices</li> <li>Microservices \u2192 Message Bus (event publishing)</li> <li>Backend \u2192 AWS SNS (notifications)</li> </ul>"},{"location":"architecture/containers/#data-flow","title":"Data Flow","text":"<ol> <li>Web app sends events to the Main Service</li> <li>Main Service publishes events to the Kafka message bus</li> <li>Microservices (Presence, Tasks) subscribe to relevant events</li> <li>Each microservice processes events and updates its own database</li> <li>Notification events are sent to AWS SNS</li> <li>AWS SNS delivers emails and push notifications to users</li> </ol> <p>Next: Component Diagram</p>"},{"location":"architecture/overview/","title":"Architecture Overview","text":"<p>HiveR follows a microservice architecture pattern with event-driven communication between services. The system is designed to be scalable, maintainable, and resilient.</p>"},{"location":"architecture/overview/#architecture-diagrams","title":"Architecture Diagrams","text":"<p>The architecture is documented using C4 diagrams created with Structurizr. These diagrams provide different levels of detail about the system structure.</p>"},{"location":"architecture/overview/#viewing-the-diagrams","title":"Viewing the Diagrams","text":"<p>Interactive C4 diagrams are embedded directly in the documentation pages below. To view them:</p> <ol> <li>Ensure Docker is installed</li> <li>Start Structurizr Lite:    <pre><code>docker run -d --name structurizr -p 8080:8080 -v $(pwd):/usr/local/structurizr structurizr/lite\n</code></pre></li> <li>The diagrams will load automatically in the pages below</li> </ol> <p>View the diagram pages:</p> <ul> <li>System Context Diagram - High-level view showing HiveR and external systems</li> <li>Container Diagram - Major containers (applications and databases)</li> <li>Component Diagram - Internal structure of the backend</li> </ul>"},{"location":"architecture/overview/#architecture-principles","title":"Architecture Principles","text":""},{"location":"architecture/overview/#event-driven-communication","title":"Event-Driven Communication","text":"<p>Services communicate asynchronously through Kafka message bus, ensuring loose coupling and high scalability.</p>"},{"location":"architecture/overview/#database-per-service","title":"Database Per Service","text":"<p>Each microservice has its own PostgreSQL database, following the database-per-service pattern for data isolation and independence.</p>"},{"location":"architecture/overview/#separation-of-concerns","title":"Separation of Concerns","text":"<ul> <li>Main Service: User management, authentication, and orchestration</li> <li>Presence Service: Specialized in tracking employee presence</li> <li>Tasks Service: Dedicated to task management workflows</li> </ul>"},{"location":"architecture/overview/#technology-stack","title":"Technology Stack","text":"Component Technology Backend Framework NestJS Message Bus Apache Kafka Databases PostgreSQL Notifications AWS SNS Mobile App (TBD) Web App (TBD)"},{"location":"architecture/overview/#system-characteristics","title":"System Characteristics","text":"<p>Scalability: Microservices can be scaled independently based on load</p> <p>Resilience: Asynchronous communication and service isolation prevent cascading failures</p> <p>Maintainability: Clear service boundaries and focused responsibilities</p> <p>Extensibility: New services can be added without modifying existing ones</p> <p>Next: System Context Diagram</p>"},{"location":"architecture/system-context/","title":"System Context Diagram","text":"<p>The system context diagram shows HiveR and how it fits in the larger ecosystem, including external systems and user types.</p>"},{"location":"architecture/system-context/#diagram","title":"Diagram","text":"C4Context     title System Context Diagram for HiveR      Person(employee, \"Employee\", \"A registered employee of a given company\")     Person(manager, \"Manager\", \"A registered manager of a given company\")     Person(admin, \"Admin\", \"An owner of a given company\")      System(hiver, \"HiveR\", \"Workforce management system for presence tracking, task management, and notifications\")      System_Ext(iot, \"IoT Devices\", \"IoT beacons and devices for presence detection\")     System_Ext(sns, \"AWS SNS\", \"Email and push notification handling\")      Rel(employee, hiver, \"Manages in-office presence using\")     Rel(manager, hiver, \"Manages workforce using\")     Rel(admin, hiver, \"Administrates the system through\")      Rel(hiver, sns, \"Sends emails to users using\")     Rel(sns, employee, \"Sends push notifications and emails to\")     Rel(sns, admin, \"Sends emails to\")      Rel(employee, iot, \"Interacts with\")     Rel(iot, hiver, \"Sends presence data to\")      UpdateLayoutConfig($c4ShapeInRow=\"3\", $c4BoundaryInRow=\"1\")"},{"location":"architecture/system-context/#system-overview","title":"System Overview","text":""},{"location":"architecture/system-context/#hiver-system","title":"HiveR System","text":"<p>The core HiveR system provides workforce management capabilities including presence tracking, task management, and notifications.</p>"},{"location":"architecture/system-context/#external-systems","title":"External Systems","text":"<p>IoT Devices - Interact with the mobile app - Used for automated presence check-ins - Respond to prompts from the mobile application</p> <p>AWS SNS - Handles email and push notification delivery - Sends notifications to employees and administrators - Integrated with the main HiveR system</p>"},{"location":"architecture/system-context/#actors","title":"Actors","text":""},{"location":"architecture/system-context/#employee","title":"Employee","text":"<p>A registered employee of a company who: - Uses the mobile app to manage in-office presence - Receives push notifications and emails - Interacts with IoT devices for check-ins</p>"},{"location":"architecture/system-context/#manager","title":"Manager","text":"<p>A registered manager who: - Uses the web application to manage workforce - Monitors employee presence and tasks - Receives notifications about team activities</p>"},{"location":"architecture/system-context/#admin","title":"Admin","text":"<p>The company owner who: - Administrates the system through the web application - Has full access to all system features - Receives administrative emails and alerts</p>"},{"location":"architecture/system-context/#key-relationships","title":"Key Relationships","text":"<ul> <li>Employees use the mobile app to interact with the system</li> <li>Managers and admins use the web application for management tasks</li> <li>The mobile app communicates with IoT devices</li> <li>HiveR sends notifications via AWS SNS</li> <li>AWS SNS delivers emails and push notifications to users</li> </ul> <p>Next: Container Diagram</p>"},{"location":"backend/bus/","title":"Message Bus (Kafka)","text":"<p>Apache Kafka serves as the central message bus for asynchronous communication between HiveR microservices.</p>"},{"location":"backend/bus/#purpose","title":"Purpose","text":"<p>The message bus provides: - Decoupled service communication - Event persistence and replay - Scalable message distribution - Reliable event delivery</p>"},{"location":"backend/bus/#topics","title":"Topics","text":""},{"location":"backend/bus/#core-topics","title":"Core Topics","text":"<p><code>user-events</code> - User lifecycle events - Authentication events - Profile updates</p> <p><code>presence-events</code> - Check-in/check-out events - Presence calculations - Schedule updates</p> <p><code>task-events</code> - Task lifecycle events - Assignment changes - Status updates</p> <p><code>notification-events</code> - Email notifications - Push notifications - System alerts</p>"},{"location":"backend/bus/#event-schema","title":"Event Schema","text":"<p>Events follow a standardized format:</p> <pre><code>{\n  \"eventId\": \"uuid\",\n  \"eventType\": \"presence.checkin\",\n  \"timestamp\": \"ISO 8601 timestamp\",\n  \"userId\": \"user identifier\",\n  \"companyId\": \"company identifier\",\n  \"payload\": {\n    // Event-specific data\n  },\n  \"metadata\": {\n    \"source\": \"service name\",\n    \"version\": \"schema version\"\n  }\n}\n</code></pre>"},{"location":"backend/bus/#consumer-groups","title":"Consumer Groups","text":"<p>Each microservice has its own consumer group: - <code>presence-service-group</code> - <code>tasks-service-group</code> - <code>notification-service-group</code></p>"},{"location":"backend/bus/#configuration","title":"Configuration","text":""},{"location":"backend/bus/#producers","title":"Producers","text":"<ul> <li>Acknowledgment: <code>all</code> (strongest guarantee)</li> <li>Compression: <code>snappy</code></li> <li>Retries: 3</li> </ul>"},{"location":"backend/bus/#consumers","title":"Consumers","text":"<ul> <li>Auto-commit: <code>false</code> (manual commit)</li> <li>Offset reset: <code>earliest</code></li> <li>Session timeout: 30s</li> </ul>"},{"location":"backend/bus/#best-practices","title":"Best Practices","text":"<ol> <li>Idempotency: Consumers should handle duplicate events</li> <li>Event Versioning: Include schema version in metadata</li> <li>Dead Letter Queue: Failed events go to DLQ for analysis</li> <li>Monitoring: Track lag, throughput, and error rates</li> </ol>"},{"location":"backend/bus/#infrastructure","title":"Infrastructure","text":"<ul> <li>Kafka cluster configuration</li> <li>Zookeeper ensemble</li> <li>Partitioning strategy</li> <li>Retention policies</li> </ul> <p>Related: Architecture Overview</p>"},{"location":"backend/main/","title":"Main Service","text":"<p>The main service is the core orchestrator of the HiveR system, handling user management, authentication, and event coordination.</p>"},{"location":"backend/main/#responsibilities","title":"Responsibilities","text":"<ul> <li>User authentication and authorization</li> <li>Company management</li> <li>API gateway functionality</li> <li>Event orchestration and publishing</li> <li>Integration with external services (AWS SNS)</li> </ul>"},{"location":"backend/main/#database-schema","title":"Database Schema","text":""},{"location":"backend/main/#main-database-postgresql","title":"Main Database (PostgreSQL)","text":"<p>Key tables: - <code>users</code> - User accounts and profiles - <code>companies</code> - Company information - <code>roles</code> - User roles and permissions - <code>sessions</code> - Active user sessions</p>"},{"location":"backend/main/#api-endpoints","title":"API Endpoints","text":"<p>(To be documented once API is finalized)</p>"},{"location":"backend/main/#event-publishing","title":"Event Publishing","text":"<p>The main service publishes events to Kafka:</p> <ul> <li><code>user.created</code> - New user registered</li> <li><code>user.updated</code> - User profile updated</li> <li><code>presence.checkin.requested</code> - Check-in initiated</li> <li><code>task.created</code> - New task created</li> <li><code>notification.send</code> - Notification requested</li> </ul>"},{"location":"backend/main/#configuration","title":"Configuration","text":"<p>Environment variables: - Database connection strings - Kafka broker URLs - AWS SNS credentials - JWT secrets</p>"},{"location":"backend/main/#dependencies","title":"Dependencies","text":"<ul> <li>PostgreSQL database</li> <li>Kafka message bus</li> <li>AWS SNS</li> </ul> <p>Related: Architecture Components</p>"},{"location":"backend/overview/","title":"Backend Overview","text":"<p>The HiveR backend is built using a microservice architecture with NestJS framework, PostgreSQL databases, and Kafka for inter-service communication.</p>"},{"location":"backend/overview/#services","title":"Services","text":"<ul> <li>Main Service - Core orchestration and user management</li> <li>Presence Microservice - Employee presence tracking</li> <li>Tasks Microservice - Task management system</li> <li>Message Bus - Event-driven communication with Kafka</li> </ul>"},{"location":"backend/overview/#architecture-patterns","title":"Architecture Patterns","text":""},{"location":"backend/overview/#microservices","title":"Microservices","text":"<p>Each service is independently deployable and scalable, with clear boundaries and responsibilities.</p>"},{"location":"backend/overview/#event-driven","title":"Event-Driven","text":"<p>Services communicate asynchronously through Kafka, reducing coupling and improving resilience.</p>"},{"location":"backend/overview/#database-per-service","title":"Database Per Service","text":"<p>Each microservice manages its own PostgreSQL database, ensuring data isolation and service autonomy.</p>"},{"location":"backend/overview/#technology-stack","title":"Technology Stack","text":"<ul> <li>Framework: NestJS (Node.js)</li> <li>Language: TypeScript</li> <li>Databases: PostgreSQL</li> <li>Message Broker: Apache Kafka</li> <li>API Style: REST/GraphQL (TBD)</li> </ul>"},{"location":"backend/overview/#development-practices","title":"Development Practices","text":""},{"location":"backend/overview/#code-organization","title":"Code Organization","text":"<p>Each service follows NestJS module structure: - Controllers (API endpoints) - Services (business logic) - Repositories (data access) - DTOs (data transfer objects) - Events (Kafka events)</p>"},{"location":"backend/overview/#testing","title":"Testing","text":"<ul> <li>Unit tests for business logic</li> <li>Integration tests for database operations</li> <li>E2E tests for API endpoints</li> <li>Event-driven tests for Kafka consumers</li> </ul>"},{"location":"backend/overview/#getting-started","title":"Getting Started","text":"<p>(Add setup instructions here once repositories are established)</p> <p>Explore individual services for detailed documentation.</p>"},{"location":"backend/presence/","title":"Presence Microservice","text":"<p>The presence microservice is responsible for tracking and managing employee presence, including check-ins, check-outs, and presence history.</p>"},{"location":"backend/presence/#responsibilities","title":"Responsibilities","text":"<ul> <li>Process check-in/check-out events</li> <li>Maintain presence history</li> <li>Calculate presence statistics</li> <li>Generate presence reports</li> <li>Manage presence schedules</li> </ul>"},{"location":"backend/presence/#database-schema","title":"Database Schema","text":""},{"location":"backend/presence/#presence-database-postgresql","title":"Presence Database (PostgreSQL)","text":"<p>Key tables: - <code>presence_records</code> - Individual check-in/out records - <code>presence_schedules</code> - Expected presence schedules - <code>presence_exceptions</code> - Holidays, sick days, etc.</p>"},{"location":"backend/presence/#event-subscriptions","title":"Event Subscriptions","text":"<p>Subscribes to Kafka events:</p> <ul> <li><code>presence.checkin</code> - Employee checked in</li> <li><code>presence.checkout</code> - Employee checked out</li> <li><code>user.created</code> - Initialize presence tracking for new user</li> </ul>"},{"location":"backend/presence/#event-publishing","title":"Event Publishing","text":"<p>Publishes events:</p> <ul> <li><code>presence.recorded</code> - Presence record created</li> <li><code>presence.anomaly</code> - Unusual presence pattern detected</li> </ul>"},{"location":"backend/presence/#business-logic","title":"Business Logic","text":""},{"location":"backend/presence/#check-in-process","title":"Check-In Process","text":"<ol> <li>Receive check-in event</li> <li>Validate against schedule</li> <li>Create presence record</li> <li>Publish confirmation event</li> </ol>"},{"location":"backend/presence/#presence-calculation","title":"Presence Calculation","text":"<ul> <li>Daily presence duration</li> <li>Weekly/monthly summaries</li> <li>Overtime calculation</li> <li>Absence tracking</li> </ul>"},{"location":"backend/presence/#configuration","title":"Configuration","text":"<p>Environment variables: - Database connection - Kafka broker - Business hours configuration</p> <p>Related: Architecture Components</p>"},{"location":"backend/tasks/","title":"Tasks Microservice","text":"<p>The tasks microservice handles all task-related operations, including creation, assignment, tracking, and completion.</p>"},{"location":"backend/tasks/#responsibilities","title":"Responsibilities","text":"<ul> <li>Task creation and management</li> <li>Task assignment to employees</li> <li>Task status tracking</li> <li>Task dependencies</li> <li>Task notifications</li> </ul>"},{"location":"backend/tasks/#database-schema","title":"Database Schema","text":""},{"location":"backend/tasks/#tasks-database-postgresql","title":"Tasks Database (PostgreSQL)","text":"<p>Key tables: - <code>tasks</code> - Task definitions and details - <code>task_assignments</code> - Employee task assignments - <code>task_dependencies</code> - Task relationships - <code>task_history</code> - Status change history</p>"},{"location":"backend/tasks/#event-subscriptions","title":"Event Subscriptions","text":"<p>Subscribes to Kafka events:</p> <ul> <li><code>task.create</code> - New task to be created</li> <li><code>task.assign</code> - Task assignment requested</li> <li><code>task.update</code> - Task update requested</li> <li><code>user.created</code> - Initialize task tracking for new user</li> </ul>"},{"location":"backend/tasks/#event-publishing","title":"Event Publishing","text":"<p>Publishes events:</p> <ul> <li><code>task.created</code> - Task successfully created</li> <li><code>task.assigned</code> - Task assigned to employee</li> <li><code>task.completed</code> - Task marked as complete</li> <li><code>task.overdue</code> - Task passed deadline</li> </ul>"},{"location":"backend/tasks/#business-logic","title":"Business Logic","text":""},{"location":"backend/tasks/#task-lifecycle","title":"Task Lifecycle","text":"<ol> <li>Created - Initial state</li> <li>Assigned - Assigned to employee(s)</li> <li>In Progress - Work started</li> <li>Completed - Finished</li> <li>Archived - Historical record</li> </ol>"},{"location":"backend/tasks/#task-features","title":"Task Features","text":"<ul> <li>Priority levels</li> <li>Due dates and reminders</li> <li>Subtasks and checklists</li> <li>Comments and attachments</li> <li>Time tracking</li> </ul>"},{"location":"backend/tasks/#configuration","title":"Configuration","text":"<p>Environment variables: - Database connection - Kafka broker - Task deadline thresholds</p> <p>Related: Architecture Components</p>"},{"location":"dupa/","title":"Backend Hiver Documentation","text":"<p>Welcome to the Backend Hiver documentation! This is a microservices-based backend system built with NestJS.</p>"},{"location":"dupa/#what-is-backend-hiver","title":"What is Backend Hiver?","text":"<p>Backend Hiver is an employee management platform backend that handles user management, presence tracking, leave requests, task management, and notifications through a distributed microservices architecture.</p>"},{"location":"dupa/#quick-links","title":"Quick Links","text":"<ul> <li>Getting Started - Set up your development environment</li> <li>Architecture Overview - Understand the system design</li> <li>Microservices - Learn about each service</li> <li>Database Design - Database schemas and relationships</li> <li>Authentication - How auth works across services</li> <li>Deployment - Production deployment guide</li> </ul>"},{"location":"dupa/#core-concepts","title":"Core Concepts","text":""},{"location":"dupa/#microservices-architecture","title":"Microservices Architecture","text":"<p>Each business domain has its own isolated service with dedicated database, enabling independent development and deployment.</p>"},{"location":"dupa/#event-driven-communication","title":"Event-Driven Communication","text":"<p>Services communicate via Apache Kafka for asynchronous event processing, ensuring loose coupling and reliability.</p>"},{"location":"dupa/#api-gateway-pattern","title":"API Gateway Pattern","text":"<p>Kong API Gateway serves as the single entry point, routing requests to appropriate microservices.</p>"},{"location":"dupa/#database-per-service","title":"Database Per Service","text":"<p>Each microservice maintains its own PostgreSQL database, following microservices best practices for data isolation.</p>"},{"location":"dupa/#technology-stack","title":"Technology Stack","text":"<ul> <li>Runtime: Node.js 20</li> <li>Framework: NestJS 11</li> <li>Database: PostgreSQL 15</li> <li>ORM: Prisma 6</li> <li>Message Queue: Apache Kafka</li> <li>API Gateway: Kong</li> <li>Authentication: JWT with Passport</li> <li>Notifications: Firebase Cloud Messaging</li> <li>Email: Nodemailer with MailHog (dev)</li> <li>Containerization: Docker &amp; Docker Compose</li> </ul>"},{"location":"dupa/#project-structure","title":"Project Structure","text":"<pre><code>backend-hiver/\n\u251c\u2500\u2500 apps/              # Microservices\n\u2502   \u251c\u2500\u2500 users/         # User &amp; company management\n\u2502   \u251c\u2500\u2500 presence/      # Check-in/out tracking\n\u2502   \u251c\u2500\u2500 tasks/         # Task management\n\u2502   \u251c\u2500\u2500 leave-requests/# Leave request handling\n\u2502   \u2514\u2500\u2500 notifications/ # Multi-channel notifications\n\u251c\u2500\u2500 libs/              # Shared libraries\n\u2502   \u251c\u2500\u2500 auth/          # Authentication &amp; authorization\n\u2502   \u251c\u2500\u2500 contracts/     # DTOs &amp; interfaces\n\u2502   \u251c\u2500\u2500 firebase/      # FCM push notifications\n\u2502   \u251c\u2500\u2500 mail/          # Email service\n\u2502   \u2514\u2500\u2500 prisma/        # Database utilities\n\u251c\u2500\u2500 prisma/            # Database schemas (per service)\n\u251c\u2500\u2500 documentation/     # This documentation\n\u2514\u2500\u2500 docker-compose.yml # Local development setup\n</code></pre>"},{"location":"dupa/#getting-help","title":"Getting Help","text":"<ul> <li>Check the FAQ for common questions</li> <li>Review Troubleshooting Guide for common issues</li> <li>See API Reference for endpoint documentation</li> </ul>"},{"location":"dupa/architecture/","title":"Architecture Overview","text":"<p>Backend Hiver follows a microservices architecture with event-driven communication, enabling scalability, maintainability, and independent deployment.</p>"},{"location":"dupa/architecture/#high-level-architecture","title":"High-Level Architecture","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   Client    \u2502\n\u2502 (Mobile/Web)\u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2502 HTTP/HTTPS\n       \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   Kong API Gateway  \u2502\u25c4\u2500\u2500\u2500 Single entry point\n\u2502   (Port 8000)       \u2502     CORS, routing, load balancing\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2502\n       \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n       \u2502              \u2502              \u2502               \u2502              \u2502\n       \u25bc              \u25bc              \u25bc               \u25bc              \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   Users   \u2502  \u2502 Presence  \u2502  \u2502   Tasks   \u2502  \u2502  Leave    \u2502  \u2502Notifications \u2502\n\u2502  Service  \u2502  \u2502  Service  \u2502  \u2502  Service  \u2502  \u2502 Requests  \u2502  \u2502   Service    \u2502\n\u2502 (Port 3000)\u2502 \u2502(Port 3001)\u2502 \u2502(Port 3003)\u2502 \u2502(Port 3002)\u2502 \u2502 (Port 3005)  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n      \u2502              \u2502              \u2502              \u2502                \u2502\n      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                    \u2502\n                                    \u25bc\n                          \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                          \u2502  Apache Kafka    \u2502\u25c4\u2500\u2500\u2500 Event Bus\n                          \u2502  (Port 9092)     \u2502     Async communication\n                          \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                    \u2502\n      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n      \u2502                             \u2502                             \u2502\n      \u25bc                             \u25bc                             \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502PostgreSQL\u2502              \u2502 Firebase FCM \u2502              \u2502   MailHog    \u2502\n\u2502(Port 5432)\u2502             \u2502(Push Notifs) \u2502              \u2502 (Port 1025)  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n5 separate DBs             Cloud service                Dev email server\n</code></pre>"},{"location":"dupa/architecture/#core-architectural-principles","title":"Core Architectural Principles","text":""},{"location":"dupa/architecture/#1-microservices-pattern","title":"1. Microservices Pattern","text":"<p>Each service is: - Autonomous: Can be developed, deployed, and scaled independently - Bounded: Owns a specific business domain - Isolated: Has its own database (no shared DB) - Resilient: Failure in one service doesn't cascade to others</p>"},{"location":"dupa/architecture/#2-database-per-service","title":"2. Database Per Service","text":"<p>Each microservice has its own PostgreSQL database:</p> <ul> <li><code>hiver_users</code> - User accounts, companies, teams</li> <li><code>hiver_presence</code> - Check-ins, NFC tags, location data</li> <li><code>hiver_tasks</code> - Tasks, assignments, statuses</li> <li><code>hiver_leave_requests</code> - Leave requests, approvals</li> <li><code>hiver_notifications</code> - Notification logs, push tokens</li> </ul> <p>Benefits: - Data encapsulation - Independent schema evolution - Technology flexibility (can use different DB types per service) - Fault isolation</p> <p>Trade-off: No database joins across services - use event-driven data replication instead.</p>"},{"location":"dupa/architecture/#3-event-driven-communication","title":"3. Event-Driven Communication","text":"<p>Services communicate asynchronously via Apache Kafka:</p> <pre><code>User Created Event Flow:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      users.create      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Users   \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba  \u2502   Kafka      \u2502\n\u2502 Service \u2502                        \u2502   Topic      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                           \u2502\n                     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                     \u2502                     \u2502             \u2502\n                     \u25bc                     \u25bc             \u25bc\n              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n              \u2502Presence  \u2502         \u2502  Tasks   \u2502  \u2502 Notifs   \u2502\n              \u2502Service   \u2502         \u2502 Service  \u2502  \u2502 Service  \u2502\n              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n               Syncs user          Syncs user     Sends welcome\n               info locally        info locally   email\n</code></pre> <p>Kafka Topics: - <code>users.create</code>, <code>users.update</code>, <code>users.remove</code> - <code>notifications.send</code> - Future: <code>tasks.assigned</code>, <code>leave.approved</code>, etc.</p> <p>Benefits: - Loose coupling between services - Asynchronous processing (non-blocking) - Event replay capability - Natural audit log</p>"},{"location":"dupa/architecture/#4-api-gateway-pattern","title":"4. API Gateway Pattern","text":"<p>Kong API Gateway provides:</p> <ul> <li>Single entry point: All client requests go through Kong</li> <li>Routing: Maps URLs to backend services</li> <li>CORS handling: Cross-origin resource sharing</li> <li>Rate limiting: Prevent abuse (can be enabled)</li> <li>SSL termination: HTTPS in production</li> <li>Authentication: Can validate JWT at gateway level (currently done per-service)</li> </ul> <p>Routes defined in <code>kong.yml</code>: <pre><code>/users \u2192 users:3000\n/presence \u2192 presence:3001\n/tasks \u2192 tasks:3003\n/leave-requests \u2192 leave-requests:3002\n/notifications \u2192 notifications:3005\n</code></pre></p>"},{"location":"dupa/architecture/#5-shared-libraries-pattern","title":"5. Shared Libraries Pattern","text":"<p>Common functionality is extracted into reusable libraries (<code>libs/</code>):</p> <ul> <li>@app/auth - JWT authentication, guards, decorators</li> <li>@app/contracts - Shared DTOs and interfaces</li> <li>@app/firebase - Firebase Cloud Messaging</li> <li>@app/mail - Email service wrapper</li> <li>@app/prisma - Database utilities</li> <li>@app/pagination - Pagination helpers</li> <li>@app/search - Search utilities</li> </ul> <p>Benefits: - Code reuse across services - Consistent patterns - Single source of truth for shared logic - Easier refactoring</p>"},{"location":"dupa/architecture/#data-flow-examples","title":"Data Flow Examples","text":""},{"location":"dupa/architecture/#1-user-login-synchronous","title":"1. User Login (Synchronous)","text":"<pre><code>1. POST /auth/login\n   Client \u2500\u2500\u2500\u2500\u2500\u2500\u25ba Kong \u2500\u2500\u2500\u2500\u2500\u2500\u25ba Users Service\n                               \u251c\u2500\u2500 Validate credentials\n                               \u251c\u2500\u2500 Generate JWT\n                               \u2514\u2500\u2500 Return token\n   Client \u25c4\u2500\u2500\u2500\u2500\u2500\u2500 Kong \u25c4\u2500\u2500\u2500\u2500\u2500\u2500 Users Service\n</code></pre>"},{"location":"dupa/architecture/#2-user-creation-event-driven","title":"2. User Creation (Event-Driven)","text":"<pre><code>1. POST /users\n   Client \u2500\u2500\u25ba Kong \u2500\u2500\u25ba Users Service\n                       \u251c\u2500\u2500 Create user in DB\n                       \u2514\u2500\u2500 Publish \"users.create\" event\n\n2. Kafka distributes event\n   Users Service \u2500\u2500\u25ba Kafka \u2500\u2500\u252c\u2500\u2500\u25ba Presence Service (creates user info)\n                             \u251c\u2500\u2500\u25ba Tasks Service (creates user info)\n                             \u2514\u2500\u2500\u25ba Notifications Service (sends welcome email)\n\n3. Response (synchronous part)\n   Client \u25c4\u2500\u2500 Kong \u25c4\u2500\u2500 Users Service (returns created user)\n</code></pre>"},{"location":"dupa/architecture/#3-push-notification-hybrid","title":"3. Push Notification (Hybrid)","text":"<pre><code>1. Task assigned in Tasks Service\n   Tasks Service \u2500\u2500\u25ba Kafka (topic: notifications.send)\n\n2. Notifications Service consumes event\n   Kafka \u2500\u2500\u25ba Notifications Service\n             \u251c\u2500\u2500 Look up user's push tokens\n             \u251c\u2500\u2500 Send via Firebase FCM\n             \u2514\u2500\u2500 Log notification in DB\n\n3. FCM delivers to device\n   Notifications Service \u2500\u2500\u25ba Firebase \u2500\u2500\u25ba Mobile Device\n</code></pre>"},{"location":"dupa/architecture/#deployment-architecture","title":"Deployment Architecture","text":""},{"location":"dupa/architecture/#development-docker-compose","title":"Development (Docker Compose)","text":"<p>All services run as Docker containers on a single machine: - Fast iteration - Consistent environment - Easy setup for new developers</p>"},{"location":"dupa/architecture/#production-aws-ecs-recommended","title":"Production (AWS ECS Recommended)","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                      AWS Cloud                          \u2502\n\u2502                                                          \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502  Application Load Balancer + AWS WAF               \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                  \u2502                                      \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502  ECS Cluster (Fargate)                            \u2502 \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u2502 \u2502\n\u2502  \u2502  \u2502 Users    \u2502  \u2502 Presence \u2502  \u2502 Tasks    \u2502        \u2502 \u2502\n\u2502  \u2502  \u2502 Service  \u2502  \u2502 Service  \u2502  \u2502 Service  \u2502  ...   \u2502 \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                  \u2502                                      \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502  Amazon MSK (Managed Kafka)                       \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                  \u2502                                      \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502  Amazon RDS (PostgreSQL) - Multi-AZ               \u2502 \u2502\n\u2502  \u2502  5 separate databases                             \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Each service auto-scales based on CPU/memory metrics.</p> <p>See Deployment Guide for detailed instructions.</p>"},{"location":"dupa/architecture/#security-architecture","title":"Security Architecture","text":""},{"location":"dupa/architecture/#authentication-flow","title":"Authentication Flow","text":"<pre><code>1. User logs in\n   Client \u2500\u2500\u25ba /auth/login \u2500\u2500\u25ba Users Service\n                               \u2514\u2500\u2500 Returns JWT\n\n2. Subsequent requests\n   Client \u2500\u2500\u25ba /tasks (+ JWT header) \u2500\u2500\u25ba Kong \u2500\u2500\u25ba Tasks Service\n                                                  \u251c\u2500\u2500 JwtAuthGuard validates token\n                                                  \u251c\u2500\u2500 Extracts user info\n                                                  \u2514\u2500\u2500 Processes request\n</code></pre>"},{"location":"dupa/architecture/#authorization-layers","title":"Authorization Layers","text":"<ol> <li>JWT Validation: All services validate JWT signatures</li> <li>Role-Based Access Control (RBAC): <code>@Roles()</code> decorator enforces roles</li> <li>Resource Ownership: Services check if user owns/can access resource</li> </ol> <p>Example: <pre><code>@UseGuards(JwtAuthGuard, RolesGuard)\n@Roles(USER_ROLE.ADMIN, USER_ROLE.MANAGER)\n@Get('reports')\ngetReports(@CurrentUser() user: AuthenticatedUser) {\n  // Only admins and managers can access\n}\n</code></pre></p>"},{"location":"dupa/architecture/#scalability-considerations","title":"Scalability Considerations","text":""},{"location":"dupa/architecture/#horizontal-scaling","title":"Horizontal Scaling","text":"<p>Each microservice can scale independently: - High user traffic? Scale users service - Heavy task processing? Scale tasks service - Notification spikes? Scale notifications service</p>"},{"location":"dupa/architecture/#stateless-services","title":"Stateless Services","text":"<p>All services are stateless: - No in-memory session storage - JWT carries authentication state - Can add/remove instances freely</p>"},{"location":"dupa/architecture/#database-scaling","title":"Database Scaling","text":"<p>Each database can scale independently: - Read replicas for read-heavy services - Vertical scaling (larger instances) - Connection pooling via Prisma</p>"},{"location":"dupa/architecture/#message-queue","title":"Message Queue","text":"<p>Kafka handles high throughput: - Partitioned topics for parallelism - Consumer groups for load distribution - Message persistence for reliability</p>"},{"location":"dupa/architecture/#technology-choices","title":"Technology Choices","text":"Component Technology Why? Framework NestJS TypeScript, dependency injection, modularity Database PostgreSQL ACID compliance, JSON support, mature ORM Prisma Type-safety, migrations, great DX Message Queue Kafka High throughput, persistence, replay API Gateway Kong Production-ready, extensible, performant Auth JWT + Passport Stateless, standard, flexible Notifications Firebase FCM Reliable, multi-platform, free tier Email Nodemailer Flexible, supports all SMTP servers"},{"location":"dupa/architecture/#next-steps","title":"Next Steps","text":"<ul> <li>Explore Microservices Documentation</li> <li>Understand Database Design</li> <li>Learn about Authentication</li> <li>See API Reference</li> </ul>"},{"location":"dupa/authentication/","title":"Authentication &amp; Authorization","text":"<p>Backend Hiver uses JWT (JSON Web Tokens) with Role-Based Access Control (RBAC) for authentication and authorization.</p>"},{"location":"dupa/authentication/#overview","title":"Overview","text":"<p>Authentication is handled by the Users service but validated by all services independently using a shared authentication library (<code>@app/auth</code>).</p>"},{"location":"dupa/authentication/#authentication-flow","title":"Authentication Flow","text":""},{"location":"dupa/authentication/#1-login","title":"1. Login","text":"<pre><code>Client                Users Service              Database\n  \u2502                        \u2502                        \u2502\n  \u251c\u2500 POST /auth/login \u2500\u2500\u2500\u2500\u25ba\u2502                        \u2502\n  \u2502  email, password       \u2502                        \u2502\n  \u2502                        \u251c\u2500 Query user \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502\n  \u2502                        \u2502\u25c4\u2500 User + hash \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n  \u2502                        \u2502                        \u2502\n  \u2502                        \u251c\u2500 Verify password       \u2502\n  \u2502                        \u251c\u2500 Generate JWT tokens   \u2502\n  \u2502                        \u2502                        \u2502\n  \u2502\u25c4\u2500 Access + Refresh \u2500\u2500\u2500\u2500\u2524                        \u2502\n  \u2502   tokens + user        \u2502                        \u2502\n</code></pre>"},{"location":"dupa/authentication/#2-authenticated-request","title":"2. Authenticated Request","text":"<pre><code>Client               Kong Gateway          Target Service\n  \u2502                       \u2502                      \u2502\n  \u251c\u2500 GET /tasks \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502                      \u2502\n  \u2502  Authorization: Bearer \u2502                      \u2502\n  \u2502                       \u251c\u2500 Route to service \u2500\u2500\u2500\u25ba\u2502\n  \u2502                       \u2502                      \u2502\n  \u2502                       \u2502                      \u251c\u2500 Extract JWT\n  \u2502                       \u2502                      \u251c\u2500 Validate signature\n  \u2502                       \u2502                      \u251c\u2500 Check expiration\n  \u2502                       \u2502                      \u251c\u2500 Verify roles\n  \u2502                       \u2502                      \u251c\u2500 Execute handler\n  \u2502                       \u2502                      \u2502\n  \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500 Response \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n</code></pre>"},{"location":"dupa/authentication/#jwt-structure","title":"JWT Structure","text":""},{"location":"dupa/authentication/#access-token-short-lived-1h","title":"Access Token (Short-lived: 1h)","text":"<pre><code>{\n  // Standard claims\n  sub: 1,                    // Subject (user ID)\n  iat: 1701461234,          // Issued at\n  exp: 1701464834,          // Expires at (1h later)\n\n  // User identity\n  email: \"alice@acme.com\",\n  role: \"ADMIN\",\n  name: \"Alice\",\n  surname: \"Admin\",\n\n  // Organization\n  companyId: 1,\n  teamIds: [1],\n  teams: [{ id: 1, name: \"Engineering\" }],\n\n  // Optional fields\n  phone: \"+1234567890\",\n  title: \"CTO\",\n  bossId: null,\n  accountStatus: \"VERIFIED\"\n}\n</code></pre>"},{"location":"dupa/authentication/#refresh-token-long-lived-7-days","title":"Refresh Token (Long-lived: 7 days)","text":"<p>Same payload as access token but longer expiration.</p>"},{"location":"dupa/authentication/#token-management","title":"Token Management","text":""},{"location":"dupa/authentication/#generating-tokens","title":"Generating Tokens","text":"<pre><code>// In Users service\nconst payload = {\n  sub: user.id,\n  email: user.email,\n  role: user.role,\n  // ... other fields\n};\n\nconst accessToken = await this.jwtService.signAsync(payload, {\n  expiresIn: process.env.JWT_EXPIRES_IN || '1h',\n});\n\nconst refreshToken = await this.jwtService.signAsync(payload, {\n  expiresIn: '7d',\n});\n</code></pre>"},{"location":"dupa/authentication/#refreshing-tokens","title":"Refreshing Tokens","text":"<pre><code>POST /auth/refresh\nContent-Type: application/json\n\n{\n  \"refreshToken\": \"eyJhbGc...\"\n}\n</code></pre> <p>Response: New access token + new refresh token.</p>"},{"location":"dupa/authentication/#token-storage-client-side","title":"Token Storage (Client-side)","text":"<p>Recommended: - Access token: Memory (not localStorage) - Refresh token: httpOnly cookie or secure storage - Implement token rotation</p>"},{"location":"dupa/authentication/#authorization","title":"Authorization","text":""},{"location":"dupa/authentication/#role-based-access-control-rbac","title":"Role-Based Access Control (RBAC)","text":"<p>Three roles with hierarchical permissions:</p> <pre><code>enum USER_ROLE {\n  ADMIN,      // Full access to company data\n  MANAGER,    // Team and subordinate management\n  EMPLOYEE    // Own data only\n}\n</code></pre> <p>Permission Hierarchy: - ADMIN can do everything MANAGER can do - MANAGER can do everything EMPLOYEE can do - EMPLOYEE has base permissions</p>"},{"location":"dupa/authentication/#guards-decorators","title":"Guards &amp; Decorators","text":""},{"location":"dupa/authentication/#jwtauthguard","title":"JwtAuthGuard","text":"<p>Validates JWT token on every request.</p> <pre><code>@UseGuards(JwtAuthGuard)\n@Get('profile')\ngetProfile(@CurrentUser() user: AuthenticatedUser) {\n  return user;\n}\n</code></pre>"},{"location":"dupa/authentication/#rolesguard","title":"RolesGuard","text":"<p>Enforces role-based access.</p> <pre><code>@UseGuards(JwtAuthGuard, RolesGuard)\n@Roles(USER_ROLE.ADMIN, USER_ROLE.MANAGER)\n@Get('reports')\ngetReports() {\n  // Only admins and managers can access\n}\n</code></pre>"},{"location":"dupa/authentication/#currentuser-decorator","title":"@CurrentUser() Decorator","text":"<p>Injects authenticated user into handler.</p> <pre><code>@Get('my-tasks')\ngetMyTasks(@CurrentUser() user: AuthenticatedUser) {\n  return this.tasksService.findByUserId(user.id);\n}\n\n// Or extract specific field\n@Get('company-users')\ngetCompanyUsers(@CurrentUser('companyId') companyId: number) {\n  return this.usersService.findByCompany(companyId);\n}\n</code></pre>"},{"location":"dupa/authentication/#resource-ownership","title":"Resource Ownership","text":"<p>Services implement ownership checks:</p> <pre><code>async updateTask(taskId: number, user: AuthenticatedUser, dto: UpdateTaskDto) {\n  const task = await this.findOne(taskId);\n\n  // Check ownership or admin/manager role\n  if (\n    task.assignedToId !== user.id &amp;&amp;\n    user.role !== USER_ROLE.ADMIN &amp;&amp;\n    user.role !== USER_ROLE.MANAGER\n  ) {\n    throw new ForbiddenException('Cannot modify task');\n  }\n\n  return this.update(taskId, dto);\n}\n</code></pre>"},{"location":"dupa/authentication/#security-best-practices","title":"Security Best Practices","text":""},{"location":"dupa/authentication/#password-security","title":"Password Security","text":"<pre><code>// Hashing on creation/update (bcrypt, 12 rounds)\nconst hashedPassword = await bcrypt.hash(plainPassword, 12);\n\n// Verification\nconst isValid = await bcrypt.compare(plainPassword, hashedPassword);\n</code></pre>"},{"location":"dupa/authentication/#token-security","title":"Token Security","text":"<ul> <li>Short expiration: Access tokens expire in 1h</li> <li>Refresh rotation: New refresh token on each use</li> <li>Secret key: Strong random string in production</li> <li>HTTPS only: Always use HTTPS in production</li> <li>httpOnly cookies: For refresh tokens when possible</li> </ul>"},{"location":"dupa/authentication/#request-validation","title":"Request Validation","text":"<p>All inputs validated using class-validator:</p> <pre><code>export class LoginDto {\n  @IsEmail()\n  email!: string;\n\n  @IsString()\n  @IsNotEmpty()\n  password!: string;\n}\n</code></pre>"},{"location":"dupa/authentication/#rate-limiting-recommended","title":"Rate Limiting (Recommended)","text":"<p>Add Kong rate limiting plugin: <pre><code>plugins:\n  - name: rate-limiting\n    config:\n      minute: 20\n      hour: 500\n</code></pre></p>"},{"location":"dupa/authentication/#authentication-library-appauth","title":"Authentication Library (@app/auth)","text":"<p>Centralized authentication logic shared across all services.</p>"},{"location":"dupa/authentication/#exports","title":"Exports","text":"<pre><code>// Guards\nexport { JwtAuthGuard } from './guards/jwt-auth.guard';\nexport { RolesGuard } from './guards/roles.guard';\n\n// Decorators\nexport { Roles } from './decorators/roles.decorator';\nexport { CurrentUser } from './decorators/current-user.decorator';\n\n// Types\nexport type { AuthenticatedUser } from './interfaces/authenticated-user.type';\n\n// Module\nexport { AuthModule } from './auth.module';\n</code></pre>"},{"location":"dupa/authentication/#usage-in-services","title":"Usage in Services","text":"<pre><code>// Import in module\nimport { AuthModule } from '@app/auth';\n\n@Module({\n  imports: [AuthModule, ...],\n  ...\n})\nexport class TasksModule {}\n\n// Use in controller\nimport { JwtAuthGuard, RolesGuard, Roles, CurrentUser } from '@app/auth';\n\n@Controller('tasks')\n@UseGuards(JwtAuthGuard, RolesGuard)\nexport class TasksController {\n  @Get()\n  @Roles(USER_ROLE.ADMIN)\n  findAll(@CurrentUser() user: AuthenticatedUser) {\n    // Implementation\n  }\n}\n</code></pre>"},{"location":"dupa/authentication/#account-states","title":"Account States","text":"<pre><code>enum ACCOUNT_STATUS {\n  PENDING,      // Registered but not verified\n  VERIFIED,     // Active account\n  SUSPENDED,    // Temporarily disabled\n  DEACTIVATED   // Permanently disabled\n}\n</code></pre> <p>Pending accounts cannot login until verified (future feature: email verification).</p>"},{"location":"dupa/authentication/#multi-tenancy","title":"Multi-Tenancy","text":"<p>Data isolation by company:</p> <pre><code>// All queries filtered by companyId\nconst users = await this.prisma.user.findMany({\n  where: {\n    companyId: currentUser.companyId,\n    // ... other filters\n  },\n});\n</code></pre> <p>Rule: Users can only access data within their company.</p>"},{"location":"dupa/authentication/#testing-authentication","title":"Testing Authentication","text":""},{"location":"dupa/authentication/#getting-a-token","title":"Getting a Token","text":"<pre><code>TOKEN=$(curl -s -X POST http://localhost:8000/auth/login \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"email\": \"alice.admin@acme.com\",\n    \"password\": \"ChangeMe123!\"\n  }' | jq -r '.accessToken')\n</code></pre>"},{"location":"dupa/authentication/#using-the-token","title":"Using the Token","text":"<pre><code>curl http://localhost:8000/users \\\n  -H \"Authorization: Bearer $TOKEN\"\n</code></pre>"},{"location":"dupa/authentication/#testing-different-roles","title":"Testing Different Roles","text":"<pre><code># Admin\nADMIN_TOKEN=$(curl -s -X POST http://localhost:8000/auth/login \\\n  -d '{\"email\":\"alice.admin@acme.com\",\"password\":\"ChangeMe123!\"}' \\\n  -H \"Content-Type: application/json\" | jq -r '.accessToken')\n\n# Manager\nMANAGER_TOKEN=$(curl -s -X POST http://localhost:8000/auth/login \\\n  -d '{\"email\":\"martin.manager@acme.com\",\"password\":\"ChangeMe123!\"}' \\\n  -H \"Content-Type: application/json\" | jq -r '.accessToken')\n\n# Employee\nEMPLOYEE_TOKEN=$(curl -s -X POST http://localhost:8000/auth/login \\\n  -d '{\"email\":\"eve.employee@globex.com\",\"password\":\"ChangeMe123!\"}' \\\n  -H \"Content-Type: application/json\" | jq -r '.accessToken')\n</code></pre>"},{"location":"dupa/authentication/#common-issues","title":"Common Issues","text":""},{"location":"dupa/authentication/#unauthorized-error","title":"\"Unauthorized\" Error","text":"<ul> <li>Token expired (refresh it)</li> <li>Token missing from header</li> <li>Invalid token signature</li> </ul>"},{"location":"dupa/authentication/#forbidden-error","title":"\"Forbidden\" Error","text":"<ul> <li>User doesn't have required role</li> <li>User doesn't own the resource</li> <li>Cross-company access attempt</li> </ul>"},{"location":"dupa/authentication/#token-not-refreshing","title":"Token Not Refreshing","text":"<ul> <li>Refresh token expired (7 days)</li> <li>User logged out (revocation feature needed)</li> </ul>"},{"location":"dupa/authentication/#environment-variables","title":"Environment Variables","text":"<pre><code># Required\nJWT_SECRET=your-long-random-secret-min-32-chars\n\n# Optional (with defaults)\nJWT_EXPIRES_IN=1h                    # Access token lifetime\nJWT_REFRESH_EXPIRES_IN=7d            # Refresh token lifetime\n</code></pre> <p>Production: Use strong random secrets (64+ characters).</p>"},{"location":"dupa/authentication/#future-enhancements","title":"Future Enhancements","text":"<ul> <li> Email verification on signup</li> <li> Password reset flow</li> <li> Two-factor authentication (2FA)</li> <li> OAuth2 integration (Google, GitHub)</li> <li> Session management and revocation</li> <li> Audit logging</li> <li> API key authentication for M2M</li> </ul>"},{"location":"dupa/authentication/#related-documentation","title":"Related Documentation","text":"<ul> <li>Users Service</li> <li>API Reference</li> <li>Security Best Practices</li> </ul>"},{"location":"dupa/database/","title":"Database Architecture","text":"<p>Backend Hiver uses the database-per-service pattern with PostgreSQL databases for each microservice.</p>"},{"location":"dupa/database/#overview","title":"Overview","text":"<p>Each microservice has its own isolated database:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Users Service  \u2502\u2500\u2500\u2500\u2500\u25ba\u2502  hiver_users    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Presence Service\u2502\u2500\u2500\u2500\u2500\u25ba\u2502 hiver_presence  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Tasks Service  \u2502\u2500\u2500\u2500\u2500\u25ba\u2502  hiver_tasks    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502Leave Req Service\u2502\u2500\u2500\u2500\u2500\u25ba\u2502hiver_leave_reqs \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502Notifications Svc\u2502\u2500\u2500\u2500\u2500\u25ba\u2502hiver_notif...   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"dupa/database/#why-database-per-service","title":"Why Database-per-Service?","text":""},{"location":"dupa/database/#benefits","title":"Benefits","text":"<p>Service Independence: - Deploy services independently - Scale databases based on service load - No shared database bottleneck</p> <p>Technology Flexibility: - Choose optimal database per service - Currently all PostgreSQL, but could use MongoDB, Redis, etc.</p> <p>Fault Isolation: - Database failure affects one service only - No cascading database failures</p> <p>Data Ownership: - Clear service boundaries - Single source of truth per domain</p>"},{"location":"dupa/database/#tradeoffs","title":"Tradeoffs","text":"<p>Data Duplication: - User data replicated across services - Mitigated: Only essential fields replicated</p> <p>No Foreign Keys Across Services: - Cannot enforce referential integrity across databases - Mitigated: Application-level validation + event sourcing</p> <p>Eventual Consistency: - Changes propagate via Kafka events - Mitigated: Use idempotent event handlers</p> <p>Complex Queries: - Cannot JOIN across services - Mitigated: API composition or CQRS (future)</p>"},{"location":"dupa/database/#database-connection","title":"Database Connection","text":"<p>All services connect via Prisma ORM:</p> <pre><code>// Service-specific Prisma client\nimport { PrismaClient } from '@generated/prisma/{service}-client';\n\nconst prisma = new PrismaClient({\n  datasourceUrl: process.env.DATABASE_URL\n});\n</code></pre> <p>Connection strings: <pre><code># Users service\nDATABASE_URL=\"postgresql://postgres:postgres@postgres:5432/hiver_users\"\n\n# Presence service\nDATABASE_URL=\"postgresql://postgres:postgres@postgres:5432/hiver_presence\"\n\n# ... etc\n</code></pre></p>"},{"location":"dupa/database/#schema-management","title":"Schema Management","text":""},{"location":"dupa/database/#prisma-schemas","title":"Prisma Schemas","text":"<p>Each service has a schema file: <pre><code>prisma/\n\u251c\u2500\u2500 users/\n\u2502   \u251c\u2500\u2500 schema.prisma        # User, Company, Team models\n\u2502   \u251c\u2500\u2500 seed.ts              # Test data\n\u2502   \u2514\u2500\u2500 migrations/          # Version history\n\u251c\u2500\u2500 presence/\n\u2502   \u251c\u2500\u2500 schema.prisma        # Checkin, NfcTag models\n\u2502   \u251c\u2500\u2500 seed.ts\n\u2502   \u2514\u2500\u2500 migrations/\n\u2514\u2500\u2500 ... (other services)\n</code></pre></p>"},{"location":"dupa/database/#schema-structure","title":"Schema Structure","text":"<p>Common pattern in all schemas:</p> <pre><code>generator client {\n  provider = \"prisma-client-js\"\n  output   = \"../../generated/prisma/{service}-client\"\n}\n\ndatasource db {\n  provider = \"postgresql\"\n  url      = env(\"DATABASE_URL\")\n}\n\n// Models...\n</code></pre>"},{"location":"dupa/database/#migrations","title":"Migrations","text":"<p>Each service manages its own migrations:</p> <pre><code># Generate migration\nnpm run prisma:migrate:dev:users\n\n# Apply migrations\nnpm run prisma:migrate:deploy:users\n\n# Reset database\nnpm run prisma:reset:users\n</code></pre>"},{"location":"dupa/database/#data-synchronization","title":"Data Synchronization","text":"<p>Services sync data via Kafka events:</p>"},{"location":"dupa/database/#example-user-creation","title":"Example: User Creation","text":"<pre><code>1. Users Service\n   \u251c\u2500\u2500 Create user in hiver_users\n   \u2514\u2500\u2500 Publish users.create event\n\n2. Kafka Topic: users.create\n   {\n     id: 5,\n     email: \"new@example.com\",\n     phone: \"+1234567890\",\n     companyId: 1\n   }\n\n3. Consuming Services\n   \u251c\u2500\u2500 Presence: Create CheckinUserInfo\n   \u251c\u2500\u2500 Tasks: Create TaskUser\n   \u251c\u2500\u2500 Leave Requests: Create LeaveRequestUser\n   \u2514\u2500\u2500 Notifications: Create NotificationUserInfo\n</code></pre>"},{"location":"dupa/database/#sync-models","title":"Sync Models","text":"<p>Each service maintains a local copy:</p> <p>Users Service (source of truth): <pre><code>model User {\n  id        Int      @id @default(autoincrement())\n  email     String   @unique\n  phone     String?\n  name      String\n  surname   String\n  role      USER_ROLE\n  companyId Int\n  // ... many more fields\n}\n</code></pre></p> <p>Tasks Service (minimal copy): <pre><code>model TaskUser {\n  id        Int      @id\n  email     String\n  phone     String?\n  companyId Int\n\n  // Relations to tasks\n  createdTasks   Task[] @relation(\"CreatedTasks\")\n  assignedTasks  Task[] @relation(\"AssignedTasks\")\n}\n</code></pre></p> <p>Only essential fields are replicated.</p>"},{"location":"dupa/database/#schema-details","title":"Schema Details","text":""},{"location":"dupa/database/#users-database-hiver_users","title":"Users Database (hiver_users)","text":"<p>Entities: - User (15+ fields) - Company - Team - UserTeam (join table)</p> <p>Key Relationships: - User belongsTo Company - User belongsToMany Team - User hasMany User (boss/subordinate) - Team belongsTo Company</p>"},{"location":"dupa/database/#presence-database-hiver_presence","title":"Presence Database (hiver_presence)","text":"<p>Entities: - CheckinUserInfo (replicated user) - Checkin - NfcTag</p> <p>Key Relationships: - Checkin belongsTo CheckinUserInfo - Checkin belongsTo NfcTag (optional) - NfcTag belongsTo Company (via companyId)</p>"},{"location":"dupa/database/#tasks-database-hiver_tasks","title":"Tasks Database (hiver_tasks)","text":"<p>Entities: - TaskUser (replicated user) - Task</p> <p>Key Relationships: - Task belongsTo TaskUser (creator) - Task belongsTo TaskUser (assignee)</p>"},{"location":"dupa/database/#leave-requests-database-hiver_leave_requests","title":"Leave Requests Database (hiver_leave_requests)","text":"<p>Entities: - LeaveRequestUser (replicated user) - LeaveRequest - LeaveBalance - LeaveType</p> <p>Key Relationships: - LeaveRequest belongsTo LeaveRequestUser - LeaveRequest belongsTo LeaveRequestUser (approver) - LeaveBalance belongsTo LeaveRequestUser</p>"},{"location":"dupa/database/#notifications-database-hiver_notifications","title":"Notifications Database (hiver_notifications)","text":"<p>Entities: - NotificationUserInfo (replicated user) - Notification - NotificationTemplate (future)</p> <p>Key Relationships: - Notification belongsTo NotificationUserInfo</p>"},{"location":"dupa/database/#indexing-strategy","title":"Indexing Strategy","text":"<p>Common indexes across services:</p> <ul> <li>Primary Keys: Auto-indexed</li> <li>Foreign Keys: Indexed for joins</li> <li>Unique Constraints: Auto-indexed</li> <li>Query Filters: Indexed (status, companyId, userId)</li> </ul> <p>Example from Tasks: <pre><code>model Task {\n  // ... fields\n\n  @@index([status])\n  @@index([assignedToId])\n  @@index([companyId])\n  @@index([createdAt])\n}\n</code></pre></p>"},{"location":"dupa/database/#data-isolation","title":"Data Isolation","text":"<p>Multi-tenancy via <code>companyId</code>:</p> <pre><code>// All queries filtered by company\nconst tasks = await prisma.task.findMany({\n  where: {\n    companyId: currentUser.companyId,\n    status: 'TODO'\n  }\n});\n</code></pre> <p>Rule: Never expose cross-company data.</p>"},{"location":"dupa/database/#seeding","title":"Seeding","text":"<p>Each schema has seed data:</p> <pre><code># Seed all databases\nnpm run prisma:seed\n\n# Seed specific service\nnpm run prisma:seed:users\n</code></pre> <p>Seed data includes: - 2 companies - 4 teams - Test users (admin, manager, employee) - Sample records per service</p>"},{"location":"dupa/database/#backup-recovery","title":"Backup &amp; Recovery","text":""},{"location":"dupa/database/#development","title":"Development","text":"<p>Docker Compose volumes persist data: <pre><code>volumes:\n  postgres-data:\n</code></pre></p> <p>Destroy and recreate: <pre><code>docker-compose down -v  # Destroys volumes\ndocker-compose up -d    # Fresh databases\nnpm run prisma:migrate:deploy  # Apply migrations\nnpm run prisma:seed            # Restore seed data\n</code></pre></p>"},{"location":"dupa/database/#production","title":"Production","text":"<p>Backup: <pre><code># Backup all databases\nfor db in hiver_users hiver_presence hiver_tasks hiver_leave_requests hiver_notifications; do\n  pg_dump -h localhost -U postgres $db &gt; backup_$db.sql\ndone\n</code></pre></p> <p>Restore: <pre><code>psql -h localhost -U postgres hiver_users &lt; backup_hiver_users.sql\n</code></pre></p>"},{"location":"dupa/database/#performance-considerations","title":"Performance Considerations","text":""},{"location":"dupa/database/#connection-pooling","title":"Connection Pooling","text":"<p>Prisma manages connection pools: <pre><code>const prisma = new PrismaClient({\n  datasourceUrl: process.env.DATABASE_URL,\n  log: ['query', 'error', 'warn'],\n});\n</code></pre></p> <p>Default pool size: 10 connections per service.</p>"},{"location":"dupa/database/#query-optimization","title":"Query Optimization","text":"<ul> <li>Use <code>select</code> to fetch only needed fields</li> <li>Avoid N+1 queries with <code>include</code></li> <li>Use pagination for large datasets</li> <li>Index frequently queried fields</li> </ul>"},{"location":"dupa/database/#database-sizing","title":"Database Sizing","text":"<p>Development (Docker): <pre><code>environment:\n  POSTGRES_SHARED_BUFFERS: 256MB\n  POSTGRES_MAX_CONNECTIONS: 100\n</code></pre></p> <p>Production (AWS RDS): - db.t3.medium (2 vCPU, 4GB RAM) minimum - Autoscaling based on load - Read replicas for reporting</p>"},{"location":"dupa/database/#troubleshooting","title":"Troubleshooting","text":""},{"location":"dupa/database/#database-does-not-exist","title":"\"Database does not exist\"","text":"<pre><code># Create missing databases\ndocker-compose exec postgres psql -U postgres -c \"CREATE DATABASE hiver_users;\"\nnpm run prisma:migrate:deploy:users\n</code></pre>"},{"location":"dupa/database/#migration-failed","title":"\"Migration failed\"","text":"<pre><code># Reset and reapply\nnpm run prisma:reset:users\nnpm run prisma:migrate:deploy:users\nnpm run prisma:seed:users\n</code></pre>"},{"location":"dupa/database/#too-many-connections","title":"\"Too many connections\"","text":"<ul> <li>Check connection pool settings</li> <li>Ensure services close connections properly</li> <li>Increase <code>POSTGRES_MAX_CONNECTIONS</code></li> </ul>"},{"location":"dupa/database/#schema-drift","title":"Schema drift","text":"<pre><code># Generate Prisma client from schema\nnpm run prisma:generate:users\n</code></pre>"},{"location":"dupa/database/#environment-variables","title":"Environment Variables","text":"<pre><code># PostgreSQL Connection\nPOSTGRES_HOST=postgres\nPOSTGRES_PORT=5432\nPOSTGRES_USER=postgres\nPOSTGRES_PASSWORD=postgres\n\n# Service-specific DATABASE_URL\nDATABASE_URL=\"postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@${POSTGRES_HOST}:${POSTGRES_PORT}/hiver_users\"\n</code></pre>"},{"location":"dupa/database/#future-enhancements","title":"Future Enhancements","text":"<ul> <li> Read replicas for reporting</li> <li> Database sharding by company</li> <li> CQRS pattern for complex queries</li> <li> Event sourcing for audit trail</li> <li> TimescaleDB for time-series data (presence)</li> <li> Redis cache layer</li> <li> GraphQL federation (cross-service queries)</li> </ul>"},{"location":"dupa/database/#related-documentation","title":"Related Documentation","text":"<ul> <li>Microservices Overview</li> <li>Data Synchronization</li> <li>Prisma Documentation</li> </ul>"},{"location":"dupa/deployment/","title":"Deployment Guide","text":"<p>This guide covers deploying Backend Hiver in different environments.</p>"},{"location":"dupa/deployment/#overview","title":"Overview","text":"<p>Backend Hiver can be deployed using: - Docker Compose (local development, staging) - AWS ECS (production) - Kubernetes (future)</p>"},{"location":"dupa/deployment/#prerequisites","title":"Prerequisites","text":""},{"location":"dupa/deployment/#development","title":"Development","text":"<ul> <li>Docker 20+ and Docker Compose 2+</li> <li>Node.js 18+</li> <li>npm or yarn</li> </ul>"},{"location":"dupa/deployment/#production","title":"Production","text":"<ul> <li>AWS account with ECS access</li> <li>Docker registry (ECR or Docker Hub)</li> <li>PostgreSQL instance (RDS)</li> <li>Kafka cluster (MSK or self-hosted)</li> </ul>"},{"location":"dupa/deployment/#docker-compose-deployment","title":"Docker Compose Deployment","text":""},{"location":"dupa/deployment/#local-development","title":"Local Development","text":"<ol> <li> <p>Clone repository: <pre><code>git clone &lt;repository-url&gt;\ncd backend-hiver\n</code></pre></p> </li> <li> <p>Set environment variables: <pre><code>cp .env.example .env\n# Edit .env with your configuration\n</code></pre></p> </li> <li> <p>Start services: <pre><code>docker-compose up -d\n</code></pre></p> </li> </ol> <p>This starts: - 5 microservices (users, presence, tasks, leave-requests, notifications) - Kong API Gateway - PostgreSQL - Kafka + Zookeeper - MailHog (email testing)</p> <ol> <li> <p>Initialize databases: <pre><code># Apply migrations\nnpm run prisma:migrate:deploy\n\n# Seed test data\nnpm run prisma:seed\n</code></pre></p> </li> <li> <p>Verify deployment: <pre><code># Check all services running\ndocker-compose ps\n\n# Test API\ncurl http://localhost:8000/users-app/health\n</code></pre></p> </li> </ol>"},{"location":"dupa/deployment/#staging-environment","title":"Staging Environment","text":"<p>Use the same process but with production-like configuration:</p> <pre><code># docker-compose.staging.yml\nservices:\n  users:\n    image: your-registry/backend-hiver-users:staging\n    environment:\n      NODE_ENV: staging\n      DATABASE_URL: ${STAGING_DATABASE_URL}\n</code></pre> <p>Deploy: <pre><code>docker-compose -f docker-compose.yml -f docker-compose.staging.yml up -d\n</code></pre></p>"},{"location":"dupa/deployment/#aws-ecs-deployment","title":"AWS ECS Deployment","text":""},{"location":"dupa/deployment/#architecture","title":"Architecture","text":"<pre><code>Internet\n   \u2502\n   \u251c\u2500\u25ba ALB (Load Balancer)\n   \u2502    \u2514\u2500\u25ba Kong Gateway (ECS Service)\n   \u2502         \u251c\u2500\u25ba Users Service (ECS Service)\n   \u2502         \u251c\u2500\u25ba Presence Service (ECS Service)\n   \u2502         \u251c\u2500\u25ba Tasks Service (ECS Service)\n   \u2502         \u251c\u2500\u25ba Leave Requests Service (ECS Service)\n   \u2502         \u2514\u2500\u25ba Notifications Service (ECS Service)\n   \u2502\n   \u251c\u2500\u25ba RDS PostgreSQL (5 databases)\n   \u2514\u2500\u25ba MSK Kafka Cluster\n</code></pre>"},{"location":"dupa/deployment/#prerequisites_1","title":"Prerequisites","text":"<ol> <li> <p>Create ECR repositories: <pre><code>aws ecr create-repository --repository-name backend-hiver-users\naws ecr create-repository --repository-name backend-hiver-presence\naws ecr create-repository --repository-name backend-hiver-tasks\naws ecr create-repository --repository-name backend-hiver-leave-requests\naws ecr create-repository --repository-name backend-hiver-notifications\naws ecr create-repository --repository-name backend-hiver-kong\n</code></pre></p> </li> <li> <p>Create RDS instance: <pre><code>aws rds create-db-instance \\\n  --db-instance-identifier backend-hiver-postgres \\\n  --db-instance-class db.t3.medium \\\n  --engine postgres \\\n  --master-username postgres \\\n  --master-user-password &lt;password&gt; \\\n  --allocated-storage 100\n</code></pre></p> </li> <li> <p>Create databases: <pre><code>psql -h &lt;rds-endpoint&gt; -U postgres -c \"CREATE DATABASE hiver_users;\"\npsql -h &lt;rds-endpoint&gt; -U postgres -c \"CREATE DATABASE hiver_presence;\"\npsql -h &lt;rds-endpoint&gt; -U postgres -c \"CREATE DATABASE hiver_tasks;\"\npsql -h &lt;rds-endpoint&gt; -U postgres -c \"CREATE DATABASE hiver_leave_requests;\"\npsql -h &lt;rds-endpoint&gt; -U postgres -c \"CREATE DATABASE hiver_notifications;\"\n</code></pre></p> </li> <li> <p>Create MSK cluster: <pre><code>aws kafka create-cluster \\\n  --cluster-name backend-hiver-kafka \\\n  --broker-node-group-info file://kafka-broker-config.json \\\n  --kafka-version 2.8.0\n</code></pre></p> </li> </ol>"},{"location":"dupa/deployment/#build-and-push-images","title":"Build and Push Images","text":"<pre><code># Login to ECR\naws ecr get-login-password --region us-east-1 | docker login --username AWS --password-stdin &lt;account-id&gt;.dkr.ecr.us-east-1.amazonaws.com\n\n# Build images\ndocker build -f Dockerfile --target users -t backend-hiver-users .\ndocker build -f Dockerfile --target presence -t backend-hiver-presence .\ndocker build -f Dockerfile --target tasks -t backend-hiver-tasks .\ndocker build -f Dockerfile --target leave-requests -t backend-hiver-leave-requests .\ndocker build -f Dockerfile --target notifications -t backend-hiver-notifications .\ndocker build -f Dockerfile.kong -t backend-hiver-kong .\n\n# Tag images\ndocker tag backend-hiver-users:latest &lt;account-id&gt;.dkr.ecr.us-east-1.amazonaws.com/backend-hiver-users:latest\n# ... repeat for other services\n\n# Push images\ndocker push &lt;account-id&gt;.dkr.ecr.us-east-1.amazonaws.com/backend-hiver-users:latest\n# ... repeat for other services\n</code></pre>"},{"location":"dupa/deployment/#create-ecs-task-definitions","title":"Create ECS Task Definitions","text":"<p>Example for Users service:</p> <pre><code>{\n  \"family\": \"backend-hiver-users\",\n  \"networkMode\": \"awsvpc\",\n  \"requiresCompatibilities\": [\"FARGATE\"],\n  \"cpu\": \"512\",\n  \"memory\": \"1024\",\n  \"containerDefinitions\": [\n    {\n      \"name\": \"users\",\n      \"image\": \"&lt;account-id&gt;.dkr.ecr.us-east-1.amazonaws.com/backend-hiver-users:latest\",\n      \"portMappings\": [\n        {\n          \"containerPort\": 3000,\n          \"protocol\": \"tcp\"\n        }\n      ],\n      \"environment\": [\n        {\n          \"name\": \"NODE_ENV\",\n          \"value\": \"production\"\n        },\n        {\n          \"name\": \"PORT\",\n          \"value\": \"3000\"\n        }\n      ],\n      \"secrets\": [\n        {\n          \"name\": \"DATABASE_URL\",\n          \"valueFrom\": \"arn:aws:secretsmanager:us-east-1:&lt;account&gt;:secret:backend-hiver/database-url\"\n        },\n        {\n          \"name\": \"JWT_SECRET\",\n          \"valueFrom\": \"arn:aws:secretsmanager:us-east-1:&lt;account&gt;:secret:backend-hiver/jwt-secret\"\n        }\n      ],\n      \"logConfiguration\": {\n        \"logDriver\": \"awslogs\",\n        \"options\": {\n          \"awslogs-group\": \"/ecs/backend-hiver-users\",\n          \"awslogs-region\": \"us-east-1\",\n          \"awslogs-stream-prefix\": \"ecs\"\n        }\n      }\n    }\n  ]\n}\n</code></pre> <p>Create task definitions: <pre><code>aws ecs register-task-definition --cli-input-json file://task-def-users.json\naws ecs register-task-definition --cli-input-json file://task-def-presence.json\n# ... repeat for other services\n</code></pre></p>"},{"location":"dupa/deployment/#create-ecs-services","title":"Create ECS Services","text":"<pre><code>aws ecs create-service \\\n  --cluster backend-hiver \\\n  --service-name users \\\n  --task-definition backend-hiver-users \\\n  --desired-count 2 \\\n  --launch-type FARGATE \\\n  --network-configuration \"awsvpcConfiguration={subnets=[subnet-xxx],securityGroups=[sg-xxx],assignPublicIp=ENABLED}\" \\\n  --load-balancers \"targetGroupArn=arn:aws:elasticloadbalancing:...,containerName=users,containerPort=3000\"\n</code></pre> <p>Repeat for all services.</p>"},{"location":"dupa/deployment/#configure-kong-gateway","title":"Configure Kong Gateway","text":"<p>Kong routing configuration is in <code>kong.ecs.yml</code>:</p> <pre><code>services:\n  - name: users\n    url: http://users.backend-hiver.local:3000\n    routes:\n      - name: users-route\n        paths:\n          - /users\n          - /auth\n          - /companies\n          - /teams\n</code></pre> <p>Apply configuration: <pre><code># Via Kong Admin API or deck sync\ndeck sync --kong-addr http://&lt;kong-admin&gt;:8001\n</code></pre></p>"},{"location":"dupa/deployment/#apply-database-migrations","title":"Apply Database Migrations","text":"<p>Run migrations from a one-off ECS task:</p> <pre><code>aws ecs run-task \\\n  --cluster backend-hiver \\\n  --task-definition backend-hiver-migrations \\\n  --launch-type FARGATE \\\n  --network-configuration \"awsvpcConfiguration={subnets=[subnet-xxx],securityGroups=[sg-xxx]}\"\n</code></pre> <p>Migration task runs: <pre><code>npm run prisma:migrate:deploy\n</code></pre></p>"},{"location":"dupa/deployment/#environment-variables","title":"Environment Variables","text":""},{"location":"dupa/deployment/#required-variables","title":"Required Variables","text":"<pre><code># Application\nNODE_ENV=production\nPORT=3000\n\n# Database (service-specific)\nDATABASE_URL=postgresql://user:pass@rds-endpoint:5432/hiver_users\n\n# JWT\nJWT_SECRET=long-random-secret-min-32-chars\nJWT_EXPIRES_IN=1h\n\n# Kafka\nKAFKA_BROKERS=broker1:9092,broker2:9092,broker3:9092\nKAFKA_CLIENT_ID=users-service\n\n# Mail (Notifications service only)\nMAIL_HOST=smtp.gmail.com\nMAIL_PORT=587\nMAIL_USER=your-email@gmail.com\nMAIL_PASSWORD=app-password\nMAIL_FROM=\"Hiver &lt;noreply@hiver.com&gt;\"\n\n# Firebase (Notifications service only)\nFIREBASE_PROJECT_ID=your-project-id\nFIREBASE_CLIENT_EMAIL=firebase-adminsdk@...\nFIREBASE_PRIVATE_KEY=\"-----BEGIN PRIVATE KEY-----\\n...\\n-----END PRIVATE KEY-----\"\n</code></pre>"},{"location":"dupa/deployment/#secrets-management","title":"Secrets Management","text":"<p>Local: <code>.env</code> file (not committed)</p> <p>AWS: Secrets Manager or Parameter Store <pre><code>aws secretsmanager create-secret \\\n  --name backend-hiver/database-url \\\n  --secret-string \"postgresql://...\"\n\naws secretsmanager create-secret \\\n  --name backend-hiver/jwt-secret \\\n  --secret-string \"&lt;random-secret&gt;\"\n</code></pre></p>"},{"location":"dupa/deployment/#health-checks","title":"Health Checks","text":"<p>Each service exposes a health endpoint:</p> <pre><code>GET /users-app/health         \u2192 Users\nGET /presence-app/health      \u2192 Presence\nGET /tasks                    \u2192 Tasks\nGET /leave-requests-app/health \u2192 Leave Requests\nGET /notifications            \u2192 Notifications\n</code></pre> <p>Configure ALB health checks: <pre><code>{\n  \"HealthCheckPath\": \"/users-app/health\",\n  \"HealthCheckIntervalSeconds\": 30,\n  \"HealthCheckTimeoutSeconds\": 5,\n  \"HealthyThresholdCount\": 2,\n  \"UnhealthyThresholdCount\": 3,\n  \"Matcher\": {\n    \"HttpCode\": \"200\"\n  }\n}\n</code></pre></p>"},{"location":"dupa/deployment/#monitoring","title":"Monitoring","text":""},{"location":"dupa/deployment/#logs","title":"Logs","text":"<p>Local: Docker logs <pre><code>docker-compose logs -f users\n</code></pre></p> <p>AWS: CloudWatch Logs <pre><code>aws logs tail /ecs/backend-hiver-users --follow\n</code></pre></p>"},{"location":"dupa/deployment/#metrics","title":"Metrics","text":"<p>Recommended CloudWatch Metrics: - CPU utilization - Memory utilization - Request count - Response time - Error rate</p> <p>Custom Metrics: - Active users - Task completion rate - Leave request approval time</p>"},{"location":"dupa/deployment/#alerting","title":"Alerting","text":"<p>Set up CloudWatch Alarms: <pre><code>aws cloudwatch put-metric-alarm \\\n  --alarm-name backend-hiver-high-cpu \\\n  --alarm-description \"High CPU usage\" \\\n  --metric-name CPUUtilization \\\n  --namespace AWS/ECS \\\n  --statistic Average \\\n  --period 300 \\\n  --threshold 80 \\\n  --comparison-operator GreaterThanThreshold \\\n  --evaluation-periods 2\n</code></pre></p>"},{"location":"dupa/deployment/#scaling","title":"Scaling","text":""},{"location":"dupa/deployment/#horizontal-scaling","title":"Horizontal Scaling","text":"<p>Auto-scaling based on CPU: <pre><code>aws application-autoscaling register-scalable-target \\\n  --service-namespace ecs \\\n  --scalable-dimension ecs:service:DesiredCount \\\n  --resource-id service/backend-hiver/users \\\n  --min-capacity 2 \\\n  --max-capacity 10\n\naws application-autoscaling put-scaling-policy \\\n  --service-namespace ecs \\\n  --scalable-dimension ecs:service:DesiredCount \\\n  --resource-id service/backend-hiver/users \\\n  --policy-name cpu-scaling \\\n  --policy-type TargetTrackingScaling \\\n  --target-tracking-scaling-policy-configuration \\\n    \"TargetValue=70.0,PredefinedMetricSpecification={PredefinedMetricType=ECSServiceAverageCPUUtilization}\"\n</code></pre></p>"},{"location":"dupa/deployment/#database-scaling","title":"Database Scaling","text":"<ul> <li>Read Replicas: For reporting/analytics</li> <li>Vertical Scaling: Upgrade RDS instance class</li> <li>Connection Pooling: Configure Prisma pool size</li> </ul>"},{"location":"dupa/deployment/#cicd-pipeline","title":"CI/CD Pipeline","text":""},{"location":"dupa/deployment/#github-actions-example","title":"GitHub Actions Example","text":"<pre><code>name: Deploy to ECS\n\non:\n  push:\n    branches: [main]\n\njobs:\n  deploy:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v2\n\n      - name: Configure AWS credentials\n        uses: aws-actions/configure-aws-credentials@v1\n        with:\n          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}\n          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}\n          aws-region: us-east-1\n\n      - name: Login to ECR\n        run: |\n          aws ecr get-login-password | docker login --username AWS --password-stdin &lt;account&gt;.dkr.ecr.us-east-1.amazonaws.com\n\n      - name: Build and push\n        run: |\n          docker build -f Dockerfile --target users -t backend-hiver-users .\n          docker tag backend-hiver-users:latest &lt;account&gt;.dkr.ecr.us-east-1.amazonaws.com/backend-hiver-users:latest\n          docker push &lt;account&gt;.dkr.ecr.us-east-1.amazonaws.com/backend-hiver-users:latest\n\n      - name: Update ECS service\n        run: |\n          aws ecs update-service --cluster backend-hiver --service users --force-new-deployment\n</code></pre>"},{"location":"dupa/deployment/#rollback","title":"Rollback","text":""},{"location":"dupa/deployment/#ecs-rollback","title":"ECS Rollback","text":"<pre><code># List task definition revisions\naws ecs list-task-definitions --family-prefix backend-hiver-users\n\n# Update service to previous revision\naws ecs update-service \\\n  --cluster backend-hiver \\\n  --service users \\\n  --task-definition backend-hiver-users:5\n</code></pre>"},{"location":"dupa/deployment/#database-rollback","title":"Database Rollback","text":"<pre><code># Rollback Prisma migration\nnpm run prisma:migrate:resolve -- --rolled-back &lt;migration-name&gt;\n</code></pre>"},{"location":"dupa/deployment/#disaster-recovery","title":"Disaster Recovery","text":""},{"location":"dupa/deployment/#backup-strategy","title":"Backup Strategy","text":"<p>Databases: - RDS automated backups (7-day retention) - Manual snapshots before major changes</p> <p>Configuration: - Version control for task definitions - Store Kong configuration in Git</p>"},{"location":"dupa/deployment/#recovery-steps","title":"Recovery Steps","text":"<ol> <li>Restore RDS from snapshot</li> <li>Deploy services from last known good images</li> <li>Apply migrations if needed</li> <li>Update DNS/load balancer</li> </ol>"},{"location":"dupa/deployment/#security","title":"Security","text":""},{"location":"dupa/deployment/#network-isolation","title":"Network Isolation","text":"<ul> <li>Services in private subnets</li> <li>Only ALB/Kong in public subnet</li> <li>Security groups restrict traffic</li> </ul>"},{"location":"dupa/deployment/#secrets","title":"Secrets","text":"<ul> <li>Never commit secrets to Git</li> <li>Use AWS Secrets Manager</li> <li>Rotate secrets regularly</li> </ul>"},{"location":"dupa/deployment/#ssltls","title":"SSL/TLS","text":"<ul> <li>ALB terminates SSL</li> <li>Use ACM certificates</li> <li>Enforce HTTPS</li> </ul>"},{"location":"dupa/deployment/#cost-optimization","title":"Cost Optimization","text":"<ul> <li>Use Fargate Spot for non-critical workloads</li> <li>Right-size ECS tasks (CPU/memory)</li> <li>Use Aurora Serverless for variable load</li> <li>Enable RDS auto-scaling storage</li> </ul>"},{"location":"dupa/deployment/#related-documentation","title":"Related Documentation","text":"<ul> <li>Getting Started</li> <li>Architecture Overview</li> <li>Environment Variables</li> </ul>"},{"location":"dupa/getting-started/","title":"Getting Started","text":"<p>This guide will help you set up your local development environment for Backend Hiver.</p>"},{"location":"dupa/getting-started/#prerequisites","title":"Prerequisites","text":"<p>Before you begin, ensure you have the following installed:</p> <ul> <li>Node.js 20+ (Download)</li> <li>Docker &amp; Docker Compose (Download)</li> <li>Git (Download)</li> </ul> <p>Optional but recommended: - kcat (formerly kafkacat) - For Kafka debugging - VS Code with REST Client extension - For API testing</p>"},{"location":"dupa/getting-started/#initial-setup","title":"Initial Setup","text":""},{"location":"dupa/getting-started/#1-clone-the-repository","title":"1. Clone the Repository","text":"<pre><code>git clone https://github.com/ZPIsaniNaSukces/backend-hiver.git\ncd backend-hiver\n</code></pre>"},{"location":"dupa/getting-started/#2-install-dependencies","title":"2. Install Dependencies","text":"<pre><code>npm install\n</code></pre>"},{"location":"dupa/getting-started/#3-environment-configuration","title":"3. Environment Configuration","text":"<p>Copy the example environment file:</p> <pre><code>cp .env.example .env\n</code></pre> <p>The default values work for local development. Key variables:</p> <pre><code># Database URLs (auto-created by Docker)\nDATABASE_URL=\"postgresql://postgres:password@localhost:5432/hiver_users\"\nPRESENCE_DATABASE_URL=\"postgresql://postgres:password@localhost:5432/hiver_presence\"\nTASKS_DATABASE_URL=\"postgresql://postgres:password@localhost:5432/hiver_tasks\"\nLEAVE_REQUESTS_DATABASE_URL=\"postgresql://postgres:password@localhost:5432/hiver_leave_requests\"\nNOTIFICATIONS_DATABASE_URL=\"postgresql://postgres:password@localhost:5432/hiver_notifications\"\n\n# Security\nJWT_SECRET=your-secret-key-change-in-production\nJWT_EXPIRES_IN=1h\n\n# Kafka\nKAFKA_BROKER=localhost:9092\n\n# Email (MailHog for development)\nMAIL_HOST=localhost\nMAIL_PORT=1025\n</code></pre>"},{"location":"dupa/getting-started/#4-start-infrastructure-services","title":"4. Start Infrastructure Services","text":"<p>Start PostgreSQL, Kafka, Zookeeper, and MailHog:</p> <pre><code>docker-compose up -d postgres kafka zookeeper mailhog\n</code></pre> <p>Wait ~10 seconds for services to be ready.</p>"},{"location":"dupa/getting-started/#5-generate-prisma-clients","title":"5. Generate Prisma Clients","text":"<p>Generate database clients for all microservices:</p> <pre><code>npm run prisma:generate\n</code></pre>"},{"location":"dupa/getting-started/#6-run-database-migrations","title":"6. Run Database Migrations","text":"<p>Create database schemas:</p> <pre><code>npm run prisma:migrate:users\nnpm run prisma:migrate:presence\nnpm run prisma:migrate:tasks\nnpm run prisma:migrate:leave-requests\nnpm run prisma:migrate:notifications\n</code></pre>"},{"location":"dupa/getting-started/#7-seed-development-data","title":"7. Seed Development Data","text":"<p>Populate databases with test data:</p> <pre><code>npm run prisma:seed\n</code></pre> <p>This creates: - 2 companies (Acme Corp, Globex) - 4 teams across companies - 3 users with different roles (Admin, Manager, Employee)</p> <p>Default test accounts: - Admin: <code>alice.admin@acme.com</code> / <code>ChangeMe123!</code> - Manager: <code>martin.manager@acme.com</code> / <code>ChangeMe123!</code> - Employee: <code>eve.employee@globex.com</code> / <code>ChangeMe123!</code></p>"},{"location":"dupa/getting-started/#running-the-application","title":"Running the Application","text":""},{"location":"dupa/getting-started/#option-a-all-services-via-docker-recommended","title":"Option A: All Services via Docker (Recommended)","text":"<p>Build and start all services:</p> <pre><code>docker-compose up -d --build\n</code></pre> <p>This starts: - All microservices (users, presence, tasks, leave-requests, notifications) - Kong API Gateway (port 8000) - Infrastructure services</p> <p>Check service health:</p> <pre><code>docker-compose ps\n</code></pre>"},{"location":"dupa/getting-started/#option-b-individual-services-for-development","title":"Option B: Individual Services for Development","text":"<p>Run specific services locally for faster development:</p> <pre><code># Terminal 1 - Users service\nnpm run start:dev users\n\n# Terminal 2 - Presence service\nnpm run start:dev presence\n\n# Terminal 3 - Tasks service\nnpm run start:dev tasks\n\n# Terminal 4 - Notifications service\nnpm run start:dev notifications\n</code></pre> <p>You'll still need Kong and infrastructure via Docker:</p> <pre><code>docker-compose up -d postgres kafka zookeeper mailhog kong-dbless\n</code></pre>"},{"location":"dupa/getting-started/#verifying-the-setup","title":"Verifying the Setup","text":""},{"location":"dupa/getting-started/#1-check-api-gateway","title":"1. Check API Gateway","text":"<pre><code>curl http://localhost:8000/auth/login \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"email\":\"alice.admin@acme.com\",\"password\":\"ChangeMe123!\"}'\n</code></pre> <p>Expected: JWT token response.</p>"},{"location":"dupa/getting-started/#2-check-mailhog-ui","title":"2. Check MailHog UI","text":"<p>Open http://localhost:8025 - You should see the MailHog web interface (email catcher for development).</p>"},{"location":"dupa/getting-started/#3-check-kafka","title":"3. Check Kafka","text":"<pre><code># List topics (requires kcat)\nkcat -L -b localhost:9092\n</code></pre> <p>Expected: List of Kafka topics including <code>users.create</code>, <code>notifications.send</code>, etc.</p>"},{"location":"dupa/getting-started/#4-check-prisma-studio","title":"4. Check Prisma Studio","text":"<p>View database contents:</p> <pre><code>npm run prisma:studio:users\n</code></pre> <p>Opens Prisma Studio at http://localhost:5555.</p>"},{"location":"dupa/getting-started/#development-workflow","title":"Development Workflow","text":""},{"location":"dupa/getting-started/#making-changes","title":"Making Changes","text":"<ol> <li>Edit code in <code>apps/</code> or <code>libs/</code></li> <li>TypeScript compilation happens automatically in watch mode</li> <li>Hot reload restarts the service</li> <li>Test changes via API or Kafka</li> </ol>"},{"location":"dupa/getting-started/#database-changes","title":"Database Changes","text":"<ol> <li>Modify schema in <code>prisma/{service}/schema.prisma</code></li> <li>Create migration:    <pre><code>npm run prisma:migrate:users  # or other service\n</code></pre></li> <li>Generate client:    <pre><code>npm run prisma:generate:users\n</code></pre></li> </ol>"},{"location":"dupa/getting-started/#testing","title":"Testing","text":"<p>Run tests:</p> <pre><code>npm test                    # All tests\nnpm run test:watch          # Watch mode\nnpm run test:cov           # With coverage\n</code></pre>"},{"location":"dupa/getting-started/#code-quality","title":"Code Quality","text":"<pre><code>npm run lint               # Check linting\nnpm run typecheck          # TypeScript validation\nnpm run format             # Format with Prettier\n</code></pre>"},{"location":"dupa/getting-started/#common-commands","title":"Common Commands","text":"<pre><code># Development\nnpm run start:dev {service}        # Start service in dev mode\nnpm run build                       # Build all services\n\n# Database\nnpm run prisma:studio:{service}    # Open Prisma Studio\nnpm run prisma:generate            # Generate all clients\nnpm run prisma:seed                # Seed all databases\n\n# Docker\ndocker-compose up -d               # Start all services\ndocker-compose logs -f {service}   # View logs\ndocker-compose restart {service}   # Restart service\ndocker-compose down                # Stop all services\n\n# Testing\n./test-push-notifications.sh       # Test push notifications\n</code></pre>"},{"location":"dupa/getting-started/#next-steps","title":"Next Steps","text":"<ul> <li>Review Architecture Overview to understand the system</li> <li>Explore API Reference for available endpoints</li> <li>Check Microservices Documentation for service details</li> <li>Read Authentication Guide for auth implementation</li> </ul>"},{"location":"dupa/getting-started/#troubleshooting","title":"Troubleshooting","text":"<p>If you encounter issues:</p> <ol> <li>Check service logs: <code>docker-compose logs {service}</code></li> <li>Verify environment: Ensure all variables in <code>.env</code> are set</li> <li>Restart services: <code>docker-compose restart</code></li> <li>Clean rebuild: <code>docker-compose down &amp;&amp; docker-compose up -d --build</code></li> <li>Check port conflicts: Ensure ports 8000, 5432, 9092 are available</li> </ol> <p>See Troubleshooting Guide for detailed solutions.</p>"},{"location":"dupa/microservices/","title":"Microservices","text":"<p>Backend Hiver consists of five independent microservices, each handling a specific business domain.</p>"},{"location":"dupa/microservices/#services-overview","title":"Services Overview","text":"Service Port Database Purpose Users 3000 <code>hiver_users</code> User accounts, companies, teams, authentication Presence 3001 <code>hiver_presence</code> Check-in/out, NFC tags, location tracking Tasks 3003 <code>hiver_tasks</code> Task management, assignments, status tracking Leave Requests 3002 <code>hiver_leave_requests</code> Leave requests, approvals, balances Notifications 3005 <code>hiver_notifications</code> Push, email, SMS notifications"},{"location":"dupa/microservices/#communication-patterns","title":"Communication Patterns","text":""},{"location":"dupa/microservices/#http-synchronous","title":"HTTP (Synchronous)","text":"<ul> <li>Client-facing APIs</li> <li>Direct service-to-service calls (rare, avoided when possible)</li> <li>Gateway routing</li> </ul>"},{"location":"dupa/microservices/#kafka-events-asynchronous","title":"Kafka Events (Asynchronous)","text":"<ul> <li>Cross-service data synchronization</li> <li>Event notifications</li> <li>Audit logging</li> </ul>"},{"location":"dupa/microservices/#common-service-structure","title":"Common Service Structure","text":"<p>Each microservice follows this structure:</p> <pre><code>apps/{service}/\n\u251c\u2500\u2500 src/\n\u2502   \u251c\u2500\u2500 main.ts                    # Entry point, bootstrap\n\u2502   \u251c\u2500\u2500 {service}.module.ts        # Root module\n\u2502   \u251c\u2500\u2500 {service}.controller.ts    # HTTP endpoints\n\u2502   \u251c\u2500\u2500 {service}.service.ts       # Business logic\n\u2502   \u251c\u2500\u2500 {service}-events.controller.ts  # Kafka event handlers\n\u2502   \u251c\u2500\u2500 {domain}/                  # Domain-specific modules\n\u2502   \u2502   \u251c\u2500\u2500 {domain}.controller.ts\n\u2502   \u2502   \u251c\u2500\u2500 {domain}.service.ts\n\u2502   \u2502   \u2514\u2500\u2500 dto/                   # Data transfer objects\n\u2502   \u2514\u2500\u2500 prisma/                    # Prisma client config\n\u2514\u2500\u2500 tsconfig.app.json              # TypeScript config\n\nprisma/{service}/\n\u251c\u2500\u2500 schema.prisma                  # Database schema\n\u251c\u2500\u2500 seed.ts                        # Test data seeding\n\u2514\u2500\u2500 migrations/                    # Database migrations\n</code></pre>"},{"location":"dupa/microservices/#service-independence","title":"Service Independence","text":"<p>Each service is independent:</p> <ul> <li>Deployable: Can deploy without affecting others</li> <li>Scalable: Scale based on individual load</li> <li>Testable: Test in isolation</li> <li>Maintainable: Team can own entire service</li> </ul>"},{"location":"dupa/microservices/#data-synchronization","title":"Data Synchronization","text":"<p>Services maintain local copies of data they need:</p> <p>Example: When a user is created in Users service: 1. Users service creates user in <code>hiver_users</code> database 2. Publishes <code>users.create</code> event to Kafka 3. Other services consume the event:    - Presence service creates <code>CheckinUserInfo</code> record    - Tasks service creates <code>TaskUser</code> record    - Notifications service creates <code>NotificationUserInfo</code> record</p> <p>Why? Each service can operate independently without cross-database queries.</p>"},{"location":"dupa/microservices/#service-responsibilities","title":"Service Responsibilities","text":""},{"location":"dupa/microservices/#users-service","title":"Users Service","text":"<ul> <li>Core Domain: User management, companies, teams</li> <li>Provides: Authentication, authorization</li> <li>Publishes: User lifecycle events</li> <li>Consumes: None (it's the source of truth)</li> </ul>"},{"location":"dupa/microservices/#presence-service","title":"Presence Service","text":"<ul> <li>Core Domain: Physical presence tracking</li> <li>Provides: Check-in/out APIs, NFC tag management</li> <li>Publishes: Presence events (future)</li> <li>Consumes: User events (to sync user data)</li> </ul>"},{"location":"dupa/microservices/#tasks-service","title":"Tasks Service","text":"<ul> <li>Core Domain: Task management</li> <li>Provides: CRUD for tasks, assignments</li> <li>Publishes: Task events (future)</li> <li>Consumes: User events (to sync user data)</li> </ul>"},{"location":"dupa/microservices/#leave-requests-service","title":"Leave Requests Service","text":"<ul> <li>Core Domain: Leave management</li> <li>Provides: Leave request workflows, approvals</li> <li>Publishes: Leave events (future)</li> <li>Consumes: User events (to sync user data)</li> </ul>"},{"location":"dupa/microservices/#notifications-service","title":"Notifications Service","text":"<ul> <li>Core Domain: Multi-channel notifications</li> <li>Provides: Push, email, SMS notifications</li> <li>Publishes: None</li> <li>Consumes: User events, notification requests</li> </ul>"},{"location":"dupa/microservices/#shared-libraries","title":"Shared Libraries","text":"<p>Services share common functionality via libraries:</p> <ul> <li>@app/auth: JWT guards, decorators, authentication logic</li> <li>@app/contracts: DTOs, interfaces, event schemas</li> <li>@app/firebase: Firebase Cloud Messaging wrapper</li> <li>@app/mail: Email sending service</li> <li>@app/prisma: Database connection utilities</li> <li>@app/pagination: Pagination helpers</li> <li>@app/search: Search functionality</li> </ul>"},{"location":"dupa/microservices/#service-communication-example","title":"Service Communication Example","text":"<p>Scenario: Admin creates a new employee</p> <pre><code>1. POST /users (HTTP)\n   \u2193\n2. Users Service\n   \u251c\u2500\u2500 Validates input\n   \u251c\u2500\u2500 Creates user in DB\n   \u251c\u2500\u2500 Hashes password\n   \u2514\u2500\u2500 Publishes Kafka event\n       \u2193\n3. Kafka Topic: users.create\n   \u251c\u2500\u2500\u2192 Presence Service: Creates CheckinUserInfo\n   \u251c\u2500\u2500\u2192 Tasks Service: Creates TaskUser  \n   \u251c\u2500\u2500\u2192 Notifications Service: Sends welcome email\n   \u2514\u2500\u2500\u2192 (Any future services)\n       \u2193\n4. HTTP Response\n   \u2190 Returns created user to client\n</code></pre>"},{"location":"dupa/microservices/#development-guidelines","title":"Development Guidelines","text":""},{"location":"dupa/microservices/#adding-a-new-service","title":"Adding a New Service","text":"<ol> <li>Create service directory in <code>apps/</code></li> <li>Create Prisma schema in <code>prisma/</code></li> <li>Add service to <code>docker-compose.yml</code></li> <li>Add routes to <code>kong.yml</code></li> <li>Update documentation</li> </ol>"},{"location":"dupa/microservices/#service-best-practices","title":"Service Best Practices","text":"<ul> <li>Single Responsibility: One service = one business domain</li> <li>API Contracts: Use DTOs from <code>@app/contracts</code></li> <li>Event Publishing: Publish events for state changes</li> <li>Error Handling: Use Prisma exception filters</li> <li>Validation: Use class-validator decorators</li> <li>Authentication: Use <code>JwtAuthGuard</code> and <code>RolesGuard</code></li> </ul>"},{"location":"dupa/microservices/#service-details","title":"Service Details","text":"<p>Click on each service to learn more:</p> <ul> <li>Users Service - User management and authentication</li> <li>Presence Service - Attendance tracking</li> <li>Tasks Service - Task management</li> <li>Leave Requests Service - Leave workflows</li> <li>Notifications Service - Multi-channel messaging</li> </ul>"},{"location":"dupa/microservices/leave-requests/","title":"Leave Requests Service","text":"<p>The Leave Requests service manages employee leave including requests, approvals, balance tracking, and leave types.</p>"},{"location":"dupa/microservices/leave-requests/#responsibilities","title":"Responsibilities","text":"<ul> <li>Leave request creation and management</li> <li>Approval workflows</li> <li>Leave balance tracking</li> <li>Leave type management (vacation, sick, etc.)</li> <li>Leave calendar and history</li> </ul>"},{"location":"dupa/microservices/leave-requests/#port-database","title":"Port &amp; Database","text":"<ul> <li>HTTP Port: 3002</li> <li>Database: <code>hiver_leave_requests</code> (PostgreSQL)</li> <li>Health Endpoint: <code>/leave-requests-app/health</code></li> </ul>"},{"location":"dupa/microservices/leave-requests/#key-entities","title":"Key Entities","text":""},{"location":"dupa/microservices/leave-requests/#leaverequestuser","title":"LeaveRequestUser","text":"<p>Local copy of user data for leave requests.</p> <p>Fields: - id (synced from Users service) - email, phone, companyId</p>"},{"location":"dupa/microservices/leave-requests/#leaverequest","title":"LeaveRequest","text":"<p>Request for time off.</p> <p>Fields: - userId, userEmail, companyId - startDate, endDate, numberOfDays - leaveType (VACATION, SICK, PERSONAL, etc.) - status (PENDING, APPROVED, REJECTED) - reason (employee's reason for leave) - approverComment (manager/admin comment) - approvedById (who approved/rejected) - createdAt, updatedAt</p>"},{"location":"dupa/microservices/leave-requests/#leavebalance","title":"LeaveBalance","text":"<p>Tracks remaining leave days per user.</p> <p>Fields: - userId - leaveType - totalDays (annual allocation) - usedDays (approved leave taken) - remainingDays (calculated)</p>"},{"location":"dupa/microservices/leave-requests/#leavetype","title":"LeaveType","text":"<p>Configurable leave categories.</p> <p>Fields: - name (VACATION, SICK, PERSONAL, MATERNITY, etc.) - description - isPaid (whether leave is paid) - requiresApproval (whether approval needed)</p>"},{"location":"dupa/microservices/leave-requests/#api-endpoints","title":"API Endpoints","text":""},{"location":"dupa/microservices/leave-requests/#leave-requests","title":"Leave Requests","text":"<pre><code>GET    /leave-requests              # List leave requests (filtered)\nPOST   /leave-requests              # Create leave request\nGET    /leave-requests/:id          # Get request details\nPATCH  /leave-requests/:id          # Update request (employee)\nDELETE /leave-requests/:id          # Delete request\n</code></pre>"},{"location":"dupa/microservices/leave-requests/#approvals","title":"Approvals","text":"<pre><code>PATCH  /leave-requests/:id/approve  # Approve request (Admin/Manager)\nPATCH  /leave-requests/:id/reject   # Reject request (Admin/Manager)\n</code></pre>"},{"location":"dupa/microservices/leave-requests/#leave-balance","title":"Leave Balance","text":"<pre><code>GET    /leave-balances              # Get user's leave balances\nGET    /leave-balances/:userId      # Get specific user balance (Admin/Manager)\n</code></pre>"},{"location":"dupa/microservices/leave-requests/#leave-types-admin","title":"Leave Types (Admin)","text":"<pre><code>GET    /leave-types                 # List leave types\nPOST   /leave-types                 # Create leave type\nPATCH  /leave-types/:id             # Update leave type\nDELETE /leave-types/:id             # Delete leave type\n</code></pre>"},{"location":"dupa/microservices/leave-requests/#requestresponse-examples","title":"Request/Response Examples","text":""},{"location":"dupa/microservices/leave-requests/#create-leave-request","title":"Create Leave Request","text":"<pre><code>POST /leave-requests\nAuthorization: Bearer {token}\nContent-Type: application/json\n\n{\n  \"leaveType\": \"VACATION\",\n  \"startDate\": \"2024-07-01\",\n  \"endDate\": \"2024-07-05\",\n  \"reason\": \"Family vacation\"\n}\n</code></pre> <p>Response: <pre><code>{\n  \"id\": 1,\n  \"userId\": 5,\n  \"userEmail\": \"eve.employee@globex.com\",\n  \"companyId\": 2,\n  \"leaveType\": \"VACATION\",\n  \"startDate\": \"2024-07-01T00:00:00.000Z\",\n  \"endDate\": \"2024-07-05T00:00:00.000Z\",\n  \"numberOfDays\": 5,\n  \"status\": \"PENDING\",\n  \"reason\": \"Family vacation\",\n  \"approverComment\": null,\n  \"approvedById\": null,\n  \"createdAt\": \"2024-01-15T10:30:00.000Z\",\n  \"updatedAt\": \"2024-01-15T10:30:00.000Z\"\n}\n</code></pre></p>"},{"location":"dupa/microservices/leave-requests/#approve-leave-request","title":"Approve Leave Request","text":"<pre><code>PATCH /leave-requests/1/approve\nAuthorization: Bearer {manager_token}\nContent-Type: application/json\n\n{\n  \"comment\": \"Approved. Enjoy your vacation!\"\n}\n</code></pre> <p>Response: <pre><code>{\n  \"id\": 1,\n  \"status\": \"APPROVED\",\n  \"approverComment\": \"Approved. Enjoy your vacation!\",\n  \"approvedById\": 2,\n  ...\n}\n</code></pre></p>"},{"location":"dupa/microservices/leave-requests/#get-leave-balance","title":"Get Leave Balance","text":"<pre><code>GET /leave-balances\nAuthorization: Bearer {token}\n</code></pre> <p>Response: <pre><code>[\n  {\n    \"leaveType\": \"VACATION\",\n    \"totalDays\": 20,\n    \"usedDays\": 5,\n    \"remainingDays\": 15\n  },\n  {\n    \"leaveType\": \"SICK\",\n    \"totalDays\": 10,\n    \"usedDays\": 2,\n    \"remainingDays\": 8\n  }\n]\n</code></pre></p>"},{"location":"dupa/microservices/leave-requests/#business-logic","title":"Business Logic","text":""},{"location":"dupa/microservices/leave-requests/#leave-request-creation","title":"Leave Request Creation","text":"<ol> <li>Validate date range (endDate &gt;= startDate)</li> <li>Calculate numberOfDays (business days)</li> <li>Check if user has sufficient balance</li> <li>Set status to PENDING</li> <li>Send notification to manager</li> </ol>"},{"location":"dupa/microservices/leave-requests/#date-calculation","title":"Date Calculation","text":"<ul> <li>Business Days: Excludes weekends (future: holidays)</li> <li>Overlap Detection: Prevents overlapping leave requests</li> <li>Balance Check: Ensures user has enough days</li> </ul>"},{"location":"dupa/microservices/leave-requests/#approval-workflow","title":"Approval Workflow","text":"<pre><code>PENDING \u2500\u2500(approve)\u2500\u2500\u25ba APPROVED \u2500\u2500\u25ba Balance updated\n   \u2502\n   \u2514\u2500\u2500(reject)\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba REJECTED\n</code></pre> <p>Rules: - Only Admin or user's Manager can approve - Cannot approve own request - Approval updates leave balance (usedDays) - Rejection does not affect balance</p>"},{"location":"dupa/microservices/leave-requests/#leave-balance-management","title":"Leave Balance Management","text":"<p>Initialization: - New user gets default balances (e.g., 20 vacation, 10 sick) - Admin can adjust balances</p> <p>Updates: - Approved leave deducts from remainingDays - Rejected/cancelled leave does not affect balance - Annual reset (future feature)</p>"},{"location":"dupa/microservices/leave-requests/#authorization-rules","title":"Authorization Rules","text":"<p>Create request: Any employee View requests: - Own requests (any user) - Team requests (Manager) - All company requests (Admin)</p> <p>Approve/Reject: - Manager can approve team member requests - Admin can approve any company request - Cannot approve own request</p> <p>Modify request: Only if status is PENDING</p>"},{"location":"dupa/microservices/leave-requests/#kafka-events","title":"Kafka Events","text":""},{"location":"dupa/microservices/leave-requests/#consumed-events","title":"Consumed Events","text":"<p>Topic: <code>users.create</code> Creates <code>LeaveRequestUser</code> record and initializes leave balances.</p> <p>Topic: <code>users.update</code> Updates <code>LeaveRequestUser</code> with new email/phone.</p> <p>Topic: <code>users.remove</code> Deletes <code>LeaveRequestUser</code> record and associated leave data.</p>"},{"location":"dupa/microservices/leave-requests/#published-events-future","title":"Published Events (Future)","text":"<p>Potential events: - <code>leave.requested</code> - Notify manager - <code>leave.approved</code> - Notify employee - <code>leave.rejected</code> - Notify employee</p>"},{"location":"dupa/microservices/leave-requests/#data-filtering","title":"Data Filtering","text":"<p>List endpoint supports:</p> <pre><code>interface LeaveRequestFilters {\n  status?: LEAVE_STATUS;        // PENDING, APPROVED, REJECTED\n  leaveType?: LEAVE_TYPE;       // VACATION, SICK, etc.\n  userId?: number;              // Filter by user\n  startDate?: Date;             // Filter by date range\n  endDate?: Date;\n  page?: number;\n  limit?: number;\n}\n</code></pre> <p>Examples: <pre><code># Pending requests\nGET /leave-requests?status=PENDING\n\n# Vacation requests in July\nGET /leave-requests?leaveType=VACATION&amp;startDate=2024-07-01&amp;endDate=2024-07-31\n\n# My requests\nGET /leave-requests?userId=5\n</code></pre></p>"},{"location":"dupa/microservices/leave-requests/#database-schema","title":"Database Schema","text":"<p>LeaveRequestUser: - Synced from Users service - Used for leave request ownership</p> <p>LeaveRequest: - Many-to-1 with LeaveRequestUser - Optional many-to-1 with LeaveRequestUser (approver) - Indexed by userId, status, leaveType, dates</p> <p>LeaveBalance: - One-to-one with User + LeaveType - Composite unique key (userId, leaveType)</p> <p>LeaveType: - Configurable by admin - Seeded with common types (VACATION, SICK, etc.)</p>"},{"location":"dupa/microservices/leave-requests/#testing","title":"Testing","text":""},{"location":"dupa/microservices/leave-requests/#create-and-approve-leave-request","title":"Create and Approve Leave Request","text":"<pre><code># Login as employee\nEMPLOYEE_TOKEN=$(curl -s -X POST http://localhost:8000/auth/login \\\n  -d '{\"email\":\"eve.employee@globex.com\",\"password\":\"ChangeMe123!\"}' \\\n  -H \"Content-Type: application/json\" | jq -r '.accessToken')\n\n# Create leave request\nLEAVE=$(curl -s -X POST http://localhost:8000/leave-requests \\\n  -H \"Authorization: Bearer $EMPLOYEE_TOKEN\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"leaveType\": \"VACATION\",\n    \"startDate\": \"2024-07-01\",\n    \"endDate\": \"2024-07-05\",\n    \"reason\": \"Summer vacation\"\n  }')\n\nLEAVE_ID=$(echo $LEAVE | jq -r '.id')\n\n# Login as manager\nMANAGER_TOKEN=$(curl -s -X POST http://localhost:8000/auth/login \\\n  -d '{\"email\":\"martin.manager@acme.com\",\"password\":\"ChangeMe123!\"}' \\\n  -H \"Content-Type: application/json\" | jq -r '.accessToken')\n\n# Approve request\ncurl -X PATCH http://localhost:8000/leave-requests/$LEAVE_ID/approve \\\n  -H \"Authorization: Bearer $MANAGER_TOKEN\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"comment\": \"Approved!\"}'\n\n# Check balance\ncurl http://localhost:8000/leave-balances \\\n  -H \"Authorization: Bearer $EMPLOYEE_TOKEN\"\n</code></pre>"},{"location":"dupa/microservices/leave-requests/#validation-rules","title":"Validation Rules","text":"<ul> <li>startDate: Required, ISO date format</li> <li>endDate: Required, must be &gt;= startDate</li> <li>leaveType: Required, must be valid LEAVE_TYPE</li> <li>reason: Optional, max 500 characters</li> <li>numberOfDays: Auto-calculated, must be &gt; 0</li> <li>Balance: Must have sufficient remaining days</li> </ul>"},{"location":"dupa/microservices/leave-requests/#error-scenarios","title":"Error Scenarios","text":""},{"location":"dupa/microservices/leave-requests/#insufficient-balance","title":"Insufficient Balance","text":"<pre><code>POST /leave-requests {\"leaveType\": \"VACATION\", \"numberOfDays\": 25}\n\u2192 400 Bad Request: \"Insufficient leave balance\"\n</code></pre>"},{"location":"dupa/microservices/leave-requests/#overlapping-dates","title":"Overlapping Dates","text":"<pre><code>POST /leave-requests (dates overlap with existing request)\n\u2192 409 Conflict: \"Leave request overlaps with existing request\"\n</code></pre>"},{"location":"dupa/microservices/leave-requests/#unauthorized-approval","title":"Unauthorized Approval","text":"<pre><code>PATCH /leave-requests/1/approve (not manager/admin)\n\u2192 403 Forbidden: \"Not authorized to approve\"\n</code></pre>"},{"location":"dupa/microservices/leave-requests/#self-approval","title":"Self-approval","text":"<pre><code>PATCH /leave-requests/1/approve (own request)\n\u2192 403 Forbidden: \"Cannot approve own request\"\n</code></pre>"},{"location":"dupa/microservices/leave-requests/#dependencies","title":"Dependencies","text":"<ul> <li>@nestjs/common: Core framework</li> <li>@prisma/client: Database access</li> <li>kafkajs: Event consumption</li> <li>class-validator: DTO validation</li> </ul>"},{"location":"dupa/microservices/leave-requests/#common-workflows","title":"Common Workflows","text":""},{"location":"dupa/microservices/leave-requests/#1-employee-requests-leave","title":"1. Employee Requests Leave","text":"<ol> <li>Employee submits request</li> <li>System validates dates and balance</li> <li>Request set to PENDING</li> <li>Manager receives notification (future)</li> </ol>"},{"location":"dupa/microservices/leave-requests/#2-manager-reviews-requests","title":"2. Manager Reviews Requests","text":"<ol> <li>Manager views pending team requests</li> <li>Reviews reason and dates</li> <li>Approves or rejects with comment</li> <li>Employee receives notification (future)</li> </ol>"},{"location":"dupa/microservices/leave-requests/#3-admin-monitors-leave","title":"3. Admin Monitors Leave","text":"<ol> <li>Admin views all company requests</li> <li>Sees leave calendar/statistics</li> <li>Adjusts balances if needed</li> </ol>"},{"location":"dupa/microservices/leave-requests/#future-enhancements","title":"Future Enhancements","text":"<ul> <li> Holiday calendar integration</li> <li> Half-day leave support</li> <li> Leave request cancellation</li> <li> Annual balance reset (rollover)</li> <li> Leave accrual (monthly accumulation)</li> <li> Delegation during leave</li> <li> Leave reports and analytics</li> <li> Public holidays configuration</li> <li> Leave calendar view</li> <li> Email notifications on status change</li> <li> Manager out-of-office auto-approval escalation</li> </ul>"},{"location":"dupa/microservices/leave-requests/#related-documentation","title":"Related Documentation","text":"<ul> <li>Database Schema</li> <li>API Reference</li> <li>Microservices Overview</li> </ul>"},{"location":"dupa/microservices/notifications/","title":"Notifications Service","text":"<p>The Notifications service provides multi-channel notification delivery including push notifications (Firebase FCM), email, and SMS.</p>"},{"location":"dupa/microservices/notifications/#responsibilities","title":"Responsibilities","text":"<ul> <li>Multi-channel notification delivery (Push, Email, SMS)</li> <li>Push notification token management</li> <li>Notification history and tracking</li> <li>User notification preferences</li> <li>Event-driven notification triggering</li> </ul>"},{"location":"dupa/microservices/notifications/#port-database","title":"Port &amp; Database","text":"<ul> <li>HTTP Port: 3005</li> <li>Database: <code>hiver_notifications</code> (PostgreSQL)</li> <li>Health Endpoint: <code>/notifications</code></li> </ul>"},{"location":"dupa/microservices/notifications/#key-features","title":"Key Features","text":""},{"location":"dupa/microservices/notifications/#push-notifications","title":"Push Notifications","text":"<ul> <li>Firebase Cloud Messaging (FCM) integration</li> <li>Multi-device support (multiple tokens per user)</li> <li>Platform-specific configurations (Android, iOS, Web)</li> <li>Automatic invalid token cleanup</li> <li>Rich notifications (title, body, image, custom data)</li> </ul>"},{"location":"dupa/microservices/notifications/#email-notifications","title":"Email Notifications","text":"<ul> <li>SMTP integration via Nodemailer</li> <li>HTML email templates</li> <li>Development mode (MailHog)</li> <li>Production mode (any SMTP server)</li> </ul>"},{"location":"dupa/microservices/notifications/#sms-notifications","title":"SMS Notifications","text":"<ul> <li>Placeholder for SMS provider integration</li> <li>Ready for AWS SNS or Twilio</li> </ul>"},{"location":"dupa/microservices/notifications/#key-entities","title":"Key Entities","text":""},{"location":"dupa/microservices/notifications/#notificationuserinfo","title":"NotificationUserInfo","text":"<p>Local copy of user data needed for notifications.</p> <p>Fields: - id (synced from Users service) - email, phone, companyId - pushTokens[] (FCM device tokens)</p>"},{"location":"dupa/microservices/notifications/#notification","title":"Notification","text":"<p>Record of sent notifications.</p> <p>Fields: - userId, type (EMAIL/SMS/PUSH) - status (PENDING/SENT/FAILED/DELIVERED) - subject, message, metadata (JSON) - sentAt, deliveredAt, errorMessage</p>"},{"location":"dupa/microservices/notifications/#notificationtemplate","title":"NotificationTemplate","text":"<p>Reusable notification templates (future feature).</p>"},{"location":"dupa/microservices/notifications/#api-endpoints","title":"API Endpoints","text":""},{"location":"dupa/microservices/notifications/#push-token-management","title":"Push Token Management","text":"<pre><code>POST   /notifications/push-tokens              # Register device token\nGET    /notifications/push-tokens              # List user's tokens\nDELETE /notifications/push-tokens/:token       # Unregister token\n</code></pre>"},{"location":"dupa/microservices/notifications/#notification-history","title":"Notification History","text":"<pre><code>GET    /notifications/notifications            # Get user's notifications\nGET    /notifications/notifications/:id        # Get specific notification\n</code></pre>"},{"location":"dupa/microservices/notifications/#health-check","title":"Health Check","text":"<pre><code>GET    /notifications                          # Service health check\n</code></pre>"},{"location":"dupa/microservices/notifications/#kafka-events","title":"Kafka Events","text":""},{"location":"dupa/microservices/notifications/#consumed-events","title":"Consumed Events","text":"<p>Topic: <code>users.create</code> Creates <code>NotificationUserInfo</code> record and sends welcome email.</p> <p>Topic: <code>users.update</code> Updates <code>NotificationUserInfo</code> with new email/phone.</p> <p>Topic: <code>users.remove</code> Deletes <code>NotificationUserInfo</code> record.</p> <p>Topic: <code>notifications.send</code> <pre><code>{\n  userId: number;\n  type: 'EMAIL' | 'SMS' | 'PUSH';\n  subject?: string;\n  message: string;\n  metadata?: Record&lt;string, any&gt;;\n}\n</code></pre> Triggers notification delivery.</p>"},{"location":"dupa/microservices/notifications/#firebase-integration","title":"Firebase Integration","text":""},{"location":"dupa/microservices/notifications/#setup","title":"Setup","text":"<p>Requires environment variables: <pre><code>FIREBASE_PROJECT_ID=your-project-id\nFIREBASE_CLIENT_EMAIL=firebase-adminsdk@...\nFIREBASE_PRIVATE_KEY=\"-----BEGIN PRIVATE KEY-----\\n...\\n-----END PRIVATE KEY-----\"\n</code></pre></p>"},{"location":"dupa/microservices/notifications/#initialization","title":"Initialization","text":"<p>Firebase Admin SDK initializes on module startup: - Validates credentials - Creates app instance - Warns if credentials missing (graceful degradation)</p>"},{"location":"dupa/microservices/notifications/#token-management","title":"Token Management","text":"<p>Adding Tokens: - Mobile app gets FCM token from Firebase SDK - App registers token via API - Token stored in user's <code>pushTokens</code> array - Supports multiple devices per user</p> <p>Invalid Token Handling: - Automatic detection during send - Invalid tokens removed from database - User not blocked from receiving future notifications</p>"},{"location":"dupa/microservices/notifications/#message-structure","title":"Message Structure","text":"<pre><code>{\n  notification: {\n    title: \"New Task\",\n    body: \"You've been assigned a task\",\n    imageUrl: \"https://...\"\n  },\n  data: {\n    taskId: \"123\",\n    type: \"TASK_ASSIGNED\"\n  },\n  android: {\n    priority: \"high\",\n    notification: {\n      sound: \"default\",\n      clickAction: \"FLUTTER_NOTIFICATION_CLICK\"\n    }\n  },\n  apns: {\n    payload: {\n      aps: {\n        alert: { title: \"...\", body: \"...\" },\n        badge: 1,\n        sound: \"default\"\n      }\n    }\n  }\n}\n</code></pre>"},{"location":"dupa/microservices/notifications/#email-integration","title":"Email Integration","text":""},{"location":"dupa/microservices/notifications/#development-mailhog","title":"Development (MailHog)","text":"<ul> <li>SMTP server: <code>localhost:1025</code></li> <li>Web UI: <code>http://localhost:8025</code></li> <li>All emails caught, no real sending</li> </ul>"},{"location":"dupa/microservices/notifications/#production","title":"Production","text":"<p>Configure any SMTP server: <pre><code>MAIL_HOST=smtp.gmail.com\nMAIL_PORT=587\nMAIL_SECURE=false\nMAIL_USER=your-email@gmail.com\nMAIL_PASSWORD=your-app-password\nMAIL_FROM=\"Hiver &lt;noreply@hiver.com&gt;\"\n</code></pre></p>"},{"location":"dupa/microservices/notifications/#email-templates","title":"Email Templates","text":"<p>Located in <code>libs/mail/src/templates/</code>: - Welcome email - Password reset - Leave approval - Generic notifications</p>"},{"location":"dupa/microservices/notifications/#notification-flow","title":"Notification Flow","text":""},{"location":"dupa/microservices/notifications/#push-notification-flow","title":"Push Notification Flow","text":"<pre><code>1. Event triggers (e.g., task assigned)\n   Tasks Service \u2192 Kafka (notifications.send)\n\n2. Notifications service consumes event\n   Kafka \u2192 Notifications Service\n   \u251c\u2500\u2500 Lookup user's push tokens\n   \u251c\u2500\u2500 Build FCM message\n   \u2514\u2500\u2500 Send to Firebase\n\n3. Firebase delivers to devices\n   Firebase \u2192 User's device(s)\n\n4. Log result\n   Notifications Service \u2192 Database (status: SENT/FAILED)\n</code></pre>"},{"location":"dupa/microservices/notifications/#email-flow","title":"Email Flow","text":"<pre><code>1. Event triggers (e.g., user created)\n   Users Service \u2192 Kafka (users.create)\n\n2. Notifications service consumes\n   Kafka \u2192 Notifications Service\n   \u251c\u2500\u2500 Get user email\n   \u251c\u2500\u2500 Render email template\n   \u2514\u2500\u2500 Send via SMTP\n\n3. Log result\n   Notifications Service \u2192 Database\n</code></pre>"},{"location":"dupa/microservices/notifications/#testing-push-notifications","title":"Testing Push Notifications","text":""},{"location":"dupa/microservices/notifications/#without-firebase-api-only","title":"Without Firebase (API Only)","text":"<p>Test token management endpoints: <pre><code># Login\nTOKEN=$(curl -s -X POST http://localhost:8000/auth/login \\\n  -d '{\"email\":\"alice.admin@acme.com\",\"password\":\"ChangeMe123!\"}' \\\n  -H \"Content-Type: application/json\" | jq -r '.accessToken')\n\n# Register token\ncurl -X POST http://localhost:8000/notifications/push-tokens \\\n  -H \"Authorization: Bearer $TOKEN\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"token\":\"test-token\",\"platform\":\"android\"}'\n\n# List tokens\ncurl http://localhost:8000/notifications/push-tokens \\\n  -H \"Authorization: Bearer $TOKEN\"\n</code></pre></p>"},{"location":"dupa/microservices/notifications/#with-firebase-configured","title":"With Firebase Configured","text":"<p>Send test notification via Kafka: <pre><code>echo '{\"userId\":1,\"type\":\"PUSH\",\"subject\":\"Test\",\"message\":\"Hello!\"}' | \\\n  kcat -P -b localhost:9092 -t notifications.send\n</code></pre></p> <p>See TESTING_PUSH_NOTIFICATIONS.md for detailed guide.</p>"},{"location":"dupa/microservices/notifications/#error-handling","title":"Error Handling","text":""},{"location":"dupa/microservices/notifications/#firebase-not-initialized","title":"Firebase Not Initialized","text":"<p>Returns error: \"Firebase is not initialized\" - Check environment variables - Restart service after adding credentials</p>"},{"location":"dupa/microservices/notifications/#no-push-tokens","title":"No Push Tokens","text":"<p>Returns error: \"User does not have any push notification tokens\" - User must register token first via API</p>"},{"location":"dupa/microservices/notifications/#invalid-tokens","title":"Invalid Tokens","text":"<ul> <li>Automatically detected during send</li> <li>Removed from database</li> <li>User receives notification on valid devices only</li> </ul>"},{"location":"dupa/microservices/notifications/#mobile-app-integration","title":"Mobile App Integration","text":""},{"location":"dupa/microservices/notifications/#flutter-example","title":"Flutter Example","text":"<pre><code>// Get FCM token\nfinal fcmToken = await FirebaseMessaging.instance.getToken();\n\n// Register with backend\nawait http.post(\n  Uri.parse('$apiUrl/notifications/push-tokens'),\n  headers: {'Authorization': 'Bearer $token'},\n  body: json.encode({'token': fcmToken, 'platform': 'android'}),\n);\n\n// Handle incoming notifications\nFirebaseMessaging.onMessage.listen((message) {\n  print('Notification: ${message.notification?.title}');\n});\n</code></pre>"},{"location":"dupa/microservices/notifications/#database-schema","title":"Database Schema","text":""},{"location":"dupa/microservices/notifications/#notificationuserinfo_1","title":"NotificationUserInfo","text":"<ul> <li>1-to-1 with User (id is user ID)</li> <li>Stores contact info and push tokens</li> <li>Auto-synced via Kafka events</li> </ul>"},{"location":"dupa/microservices/notifications/#notification_1","title":"Notification","text":"<ul> <li>Many-to-1 with NotificationUserInfo</li> <li>Records all sent notifications</li> <li>Indexed by userId, type, status</li> </ul>"},{"location":"dupa/microservices/notifications/#dependencies","title":"Dependencies","text":"<ul> <li>firebase-admin: Firebase Cloud Messaging SDK</li> <li>@nestjs-modules/mailer: Email service wrapper</li> <li>nodemailer: SMTP email sending</li> <li>kafkajs: Kafka client</li> </ul>"},{"location":"dupa/microservices/notifications/#related-documentation","title":"Related Documentation","text":"<ul> <li>Firebase Setup Guide</li> <li>Testing Guide</li> <li>API Reference</li> </ul>"},{"location":"dupa/microservices/presence/","title":"Presence Service","text":"<p>The Presence service manages employee attendance tracking through check-ins, check-outs, and NFC tag-based location verification.</p>"},{"location":"dupa/microservices/presence/#responsibilities","title":"Responsibilities","text":"<ul> <li>Physical presence tracking (check-in/out)</li> <li>NFC tag management for location verification</li> <li>User check-in history</li> <li>Location-based attendance validation</li> </ul>"},{"location":"dupa/microservices/presence/#port-database","title":"Port &amp; Database","text":"<ul> <li>HTTP Port: 3001</li> <li>Database: <code>hiver_presence</code> (PostgreSQL)</li> <li>Health Endpoint: <code>/presence-app/health</code></li> </ul>"},{"location":"dupa/microservices/presence/#key-entities","title":"Key Entities","text":""},{"location":"dupa/microservices/presence/#checkinuserinfo","title":"CheckinUserInfo","text":"<p>Local copy of user data for check-ins.</p> <p>Fields: - id (synced from Users service) - email, phone, companyId</p>"},{"location":"dupa/microservices/presence/#checkin","title":"Checkin","text":"<p>Attendance record for a user.</p> <p>Fields: - userId, userEmail, companyId - checkinTime (when user checked in) - checkoutTime (when user checked out, nullable) - nfcTagId (if checked in via NFC) - status (CHECKED_IN/CHECKED_OUT)</p>"},{"location":"dupa/microservices/presence/#nfctag","title":"NfcTag","text":"<p>Physical NFC tags placed at office locations.</p> <p>Fields: - tagId (unique identifier) - location (e.g., \"Main Office\", \"Warehouse\") - companyId</p>"},{"location":"dupa/microservices/presence/#api-endpoints","title":"API Endpoints","text":""},{"location":"dupa/microservices/presence/#check-inout","title":"Check-in/out","text":"<pre><code>POST   /checkin                      # Check in (with optional NFC)\nPOST   /checkin/checkout             # Check out\nGET    /checkin/status               # Get current check-in status\nGET    /checkin                      # Get check-in history\n</code></pre>"},{"location":"dupa/microservices/presence/#nfc-tags","title":"NFC Tags","text":"<pre><code>GET    /nfc-tags                     # List company's NFC tags\nPOST   /nfc-tags                     # Create NFC tag\nGET    /nfc-tags/:id                 # Get tag details\nPATCH  /nfc-tags/:id                 # Update tag\nDELETE /nfc-tags/:id                 # Delete tag\n</code></pre>"},{"location":"dupa/microservices/presence/#user-info-internal","title":"User Info (Internal)","text":"<pre><code>GET    /checkin-user-info            # List synced users\nGET    /checkin-user-info/:id        # Get user info\n</code></pre>"},{"location":"dupa/microservices/presence/#business-logic","title":"Business Logic","text":""},{"location":"dupa/microservices/presence/#check-in-flow","title":"Check-in Flow","text":"<pre><code>1. User initiates check-in\n   \u251c\u2500\u2500 Optional: Scans NFC tag\n   \u2514\u2500\u2500 Submits check-in request\n\n2. Service validates\n   \u251c\u2500\u2500 User not already checked in\n   \u251c\u2500\u2500 NFC tag exists (if provided)\n   \u2514\u2500\u2500 NFC tag belongs to user's company\n\n3. Create check-in record\n   \u251c\u2500\u2500 Save checkinTime\n   \u251c\u2500\u2500 Save nfcTagId (if used)\n   \u2514\u2500\u2500 Set status: CHECKED_IN\n\n4. Return confirmation\n</code></pre>"},{"location":"dupa/microservices/presence/#check-out-flow","title":"Check-out Flow","text":"<pre><code>1. User initiates check-out\n\n2. Service validates\n   \u251c\u2500\u2500 User is currently checked in\n   \u2514\u2500\u2500 Checkout time &gt; checkin time\n\n3. Update check-in record\n   \u251c\u2500\u2500 Save checkoutTime\n   \u2514\u2500\u2500 Set status: CHECKED_OUT\n\n4. Calculate duration worked\n</code></pre>"},{"location":"dupa/microservices/presence/#nfc-tag-verification","title":"NFC Tag Verification","text":"<p>NFC tags enable location-based attendance: - Admin registers NFC tags with locations - Employee scans tag during check-in - System verifies employee is at registered location - Record includes location in check-in data</p>"},{"location":"dupa/microservices/presence/#kafka-events","title":"Kafka Events","text":""},{"location":"dupa/microservices/presence/#consumed-events","title":"Consumed Events","text":"<p>Topic: <code>users.create</code> Creates <code>CheckinUserInfo</code> record for new users.</p> <p>Topic: <code>users.update</code> Updates <code>CheckinUserInfo</code> with new email/phone.</p> <p>Topic: <code>users.remove</code> Deletes <code>CheckinUserInfo</code> record.</p>"},{"location":"dupa/microservices/presence/#published-events-future","title":"Published Events (Future)","text":"<p>Potential events for other services: - <code>presence.checkin</code> - When employee checks in - <code>presence.checkout</code> - When employee checks out</p>"},{"location":"dupa/microservices/presence/#use-cases","title":"Use Cases","text":""},{"location":"dupa/microservices/presence/#1-office-check-in","title":"1. Office Check-in","text":"<p>Employee arrives at office: 1. Scans NFC tag at entrance 2. App captures tag ID 3. Submits check-in with tag ID 4. System validates and records</p>"},{"location":"dupa/microservices/presence/#2-remote-check-in","title":"2. Remote Check-in","text":"<p>Employee works remotely: 1. Opens app 2. Clicks \"Check In\" 3. System records without NFC tag</p>"},{"location":"dupa/microservices/presence/#3-multi-location-check-in","title":"3. Multi-location Check-in","text":"<p>Company has multiple offices: 1. Admin creates NFC tags per location 2. Employee checks in at correct location 3. System tracks which office employee used</p>"},{"location":"dupa/microservices/presence/#database-schema","title":"Database Schema","text":"<p>CheckinUserInfo: - Synced from Users service via Kafka - Used to join check-ins with user data - Prevents cross-service database queries</p> <p>Checkin: - Many-to-1 with CheckinUserInfo - Optional many-to-1 with NfcTag - Indexed by userId, checkinTime, status</p> <p>NfcTag: - Many-to-1 with Company - Unique constraint on tagId</p>"},{"location":"dupa/microservices/presence/#data-synchronization","title":"Data Synchronization","text":"<p>User data flows from Users service:</p> <pre><code>Users Service                Presence Service\n      \u2502                            \u2502\n      \u251c\u2500 CREATE user              \u2502\n      \u251c\u2500 Publish Kafka event \u2500\u2500\u2500\u2500\u25ba\u2502\n      \u2502                           \u251c\u2500 Consume event\n      \u2502                           \u251c\u2500 CREATE CheckinUserInfo\n      \u2502                           \u2514\u2500 Ready for check-ins\n</code></pre> <p>This ensures Presence service can operate independently without querying Users service.</p>"},{"location":"dupa/microservices/presence/#testing","title":"Testing","text":"<p>Seed data includes: - 1 NFC tag per company - Sample check-in records</p> <p>Test check-in: <pre><code># Login\nTOKEN=$(curl -s -X POST http://localhost:8000/auth/login \\\n  -d '{\"email\":\"alice.admin@acme.com\",\"password\":\"ChangeMe123!\"}' \\\n  -H \"Content-Type: application/json\" | jq -r '.accessToken')\n\n# Check in\ncurl -X POST http://localhost:8000/checkin \\\n  -H \"Authorization: Bearer $TOKEN\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"nfcTagId\":\"acme-nfc-001\"}'\n\n# Get status\ncurl http://localhost:8000/checkin/status \\\n  -H \"Authorization: Bearer $TOKEN\"\n\n# Check out\ncurl -X POST http://localhost:8000/checkin/checkout \\\n  -H \"Authorization: Bearer $TOKEN\"\n</code></pre></p>"},{"location":"dupa/microservices/presence/#authorization","title":"Authorization","text":"<ul> <li>Check-in/out: Any authenticated user</li> <li>NFC Tag Management: Admin only</li> <li>View History: Own history or Admin/Manager for team</li> </ul>"},{"location":"dupa/microservices/presence/#common-operations","title":"Common Operations","text":""},{"location":"dupa/microservices/presence/#register-nfc-tag","title":"Register NFC Tag","text":"<pre><code>curl -X POST http://localhost:8000/nfc-tags \\\n  -H \"Authorization: Bearer $ADMIN_TOKEN\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"tagId\": \"nfc-entrance-01\",\n    \"location\": \"Main Entrance\"\n  }'\n</code></pre>"},{"location":"dupa/microservices/presence/#check-in-with-nfc","title":"Check-in with NFC","text":"<pre><code>curl -X POST http://localhost:8000/checkin \\\n  -H \"Authorization: Bearer $TOKEN\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"nfcTagId\": \"nfc-entrance-01\"\n  }'\n</code></pre>"},{"location":"dupa/microservices/presence/#get-check-in-history","title":"Get Check-in History","text":"<pre><code># My history\ncurl \"http://localhost:8000/checkin?page=1&amp;limit=10\" \\\n  -H \"Authorization: Bearer $TOKEN\"\n\n# Specific date range (future feature)\ncurl \"http://localhost:8000/checkin?startDate=2024-01-01&amp;endDate=2024-01-31\" \\\n  -H \"Authorization: Bearer $TOKEN\"\n</code></pre>"},{"location":"dupa/microservices/presence/#error-scenarios","title":"Error Scenarios","text":""},{"location":"dupa/microservices/presence/#already-checked-in","title":"Already Checked In","text":"<pre><code>POST /checkin\n\u2192 400 Bad Request: \"User is already checked in\"\n</code></pre>"},{"location":"dupa/microservices/presence/#not-checked-in","title":"Not Checked In","text":"<pre><code>POST /checkin/checkout\n\u2192 400 Bad Request: \"User is not checked in\"\n</code></pre>"},{"location":"dupa/microservices/presence/#invalid-nfc-tag","title":"Invalid NFC Tag","text":"<pre><code>POST /checkin {\"nfcTagId\": \"unknown\"}\n\u2192 404 Not Found: \"NFC tag not found\"\n</code></pre>"},{"location":"dupa/microservices/presence/#cross-company-nfc-tag","title":"Cross-Company NFC Tag","text":"<pre><code>POST /checkin {\"nfcTagId\": \"other-company-tag\"}\n\u2192 403 Forbidden: \"NFC tag does not belong to your company\"\n</code></pre>"},{"location":"dupa/microservices/presence/#dependencies","title":"Dependencies","text":"<ul> <li>@nestjs/common: Core framework</li> <li>@prisma/client: Database access</li> <li>kafkajs: Event consumption</li> </ul>"},{"location":"dupa/microservices/presence/#future-enhancements","title":"Future Enhancements","text":"<ul> <li> Geolocation verification</li> <li> Photo capture during check-in</li> <li> Shift scheduling integration</li> <li> Automatic check-out (end of day)</li> <li> Break time tracking</li> <li> Attendance reports</li> <li> Overtime calculation</li> <li> Leave integration (skip check-in on leave days)</li> </ul>"},{"location":"dupa/microservices/presence/#related-documentation","title":"Related Documentation","text":"<ul> <li>Database Schema</li> <li>API Reference</li> <li>Microservices Overview</li> </ul>"},{"location":"dupa/microservices/tasks/","title":"Tasks Service","text":"<p>The Tasks service provides task management functionality for assigning, tracking, and completing work items.</p>"},{"location":"dupa/microservices/tasks/#responsibilities","title":"Responsibilities","text":"<ul> <li>Task CRUD operations</li> <li>Task assignment to users</li> <li>Status tracking (TODO, IN_PROGRESS, DONE)</li> <li>Priority management</li> <li>Due date tracking</li> </ul>"},{"location":"dupa/microservices/tasks/#port-database","title":"Port &amp; Database","text":"<ul> <li>HTTP Port: 3003</li> <li>Database: <code>hiver_tasks</code> (PostgreSQL)</li> <li>Health Endpoint: <code>/tasks</code></li> </ul>"},{"location":"dupa/microservices/tasks/#key-entities","title":"Key Entities","text":""},{"location":"dupa/microservices/tasks/#taskuser","title":"TaskUser","text":"<p>Local copy of user data for task assignments.</p> <p>Fields: - id (synced from Users service) - email, phone, companyId</p>"},{"location":"dupa/microservices/tasks/#task","title":"Task","text":"<p>Work item that can be assigned to users.</p> <p>Fields: - title, description - status (TODO, IN_PROGRESS, DONE) - priority (LOW, MEDIUM, HIGH, URGENT) - dueDate (optional) - createdById, assignedToId - companyId (for multi-tenancy)</p>"},{"location":"dupa/microservices/tasks/#api-endpoints","title":"API Endpoints","text":""},{"location":"dupa/microservices/tasks/#tasks","title":"Tasks","text":"<pre><code>GET    /tasks                       # List tasks (filtered, paginated)\nPOST   /tasks                       # Create task\nGET    /tasks/:id                   # Get task details\nPATCH  /tasks/:id                   # Update task\nDELETE /tasks/:id                   # Delete task\n</code></pre>"},{"location":"dupa/microservices/tasks/#task-users-internal","title":"Task Users (Internal)","text":"<pre><code>GET    /task-users                  # List synced users\nGET    /task-users/:id              # Get user info\n</code></pre>"},{"location":"dupa/microservices/tasks/#requestresponse-examples","title":"Request/Response Examples","text":""},{"location":"dupa/microservices/tasks/#create-task","title":"Create Task","text":"<pre><code>POST /tasks\nAuthorization: Bearer {token}\nContent-Type: application/json\n\n{\n  \"title\": \"Implement user authentication\",\n  \"description\": \"Add JWT-based authentication to API\",\n  \"status\": \"TODO\",\n  \"priority\": \"HIGH\",\n  \"assignedToId\": 5,\n  \"dueDate\": \"2024-12-31\"\n}\n</code></pre> <p>Response: <pre><code>{\n  \"id\": 1,\n  \"title\": \"Implement user authentication\",\n  \"description\": \"Add JWT-based authentication to API\",\n  \"status\": \"TODO\",\n  \"priority\": \"HIGH\",\n  \"dueDate\": \"2024-12-31T00:00:00.000Z\",\n  \"createdById\": 1,\n  \"assignedToId\": 5,\n  \"companyId\": 1,\n  \"createdAt\": \"2024-01-15T10:30:00.000Z\",\n  \"updatedAt\": \"2024-01-15T10:30:00.000Z\"\n}\n</code></pre></p>"},{"location":"dupa/microservices/tasks/#list-tasks-filtered","title":"List Tasks (Filtered)","text":"<pre><code>GET /tasks?status=TODO&amp;assignedToId=5&amp;page=1&amp;limit=10\nAuthorization: Bearer {token}\n</code></pre> <p>Response: <pre><code>{\n  \"data\": [\n    {\n      \"id\": 1,\n      \"title\": \"Implement user authentication\",\n      \"status\": \"TODO\",\n      \"priority\": \"HIGH\",\n      ...\n    }\n  ],\n  \"meta\": {\n    \"total\": 15,\n    \"page\": 1,\n    \"limit\": 10,\n    \"totalPages\": 2\n  }\n}\n</code></pre></p>"},{"location":"dupa/microservices/tasks/#update-task-status","title":"Update Task Status","text":"<pre><code>PATCH /tasks/1\nAuthorization: Bearer {token}\nContent-Type: application/json\n\n{\n  \"status\": \"IN_PROGRESS\"\n}\n</code></pre>"},{"location":"dupa/microservices/tasks/#business-logic","title":"Business Logic","text":""},{"location":"dupa/microservices/tasks/#task-creation","title":"Task Creation","text":"<ol> <li>Validate required fields (title)</li> <li>Set createdById to current user</li> <li>Validate assignedToId exists in same company</li> <li>Set default status (TODO if not provided)</li> <li>Save to database</li> </ol>"},{"location":"dupa/microservices/tasks/#task-assignment","title":"Task Assignment","text":"<ul> <li>Only users in same company can be assigned</li> <li>Task creator automatically tracked</li> <li>Notifications sent to assignee (future)</li> </ul>"},{"location":"dupa/microservices/tasks/#status-transitions","title":"Status Transitions","text":"<p>Valid flow: <pre><code>TODO \u2192 IN_PROGRESS \u2192 DONE\n  \u2191                    \u2193\n  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre></p> <p>All transitions allowed (can reopen tasks).</p>"},{"location":"dupa/microservices/tasks/#priority-levels","title":"Priority Levels","text":"<pre><code>enum TASK_PRIORITY {\n  LOW,      // Nice to have\n  MEDIUM,   // Standard priority\n  HIGH,     // Important\n  URGENT    // Critical, immediate attention\n}\n</code></pre>"},{"location":"dupa/microservices/tasks/#authorization-rules","title":"Authorization Rules","text":"<p>View tasks: - Admin: All tasks in company - Manager: Team tasks + own tasks - Employee: Only own tasks (created by or assigned to)</p> <p>Create tasks: - Any user can create tasks - Can assign to any user in same company</p> <p>Update tasks: - Task creator - Task assignee - Admin/Manager</p> <p>Delete tasks: - Admin only (future: creator can delete if no assignee)</p>"},{"location":"dupa/microservices/tasks/#kafka-events","title":"Kafka Events","text":""},{"location":"dupa/microservices/tasks/#consumed-events","title":"Consumed Events","text":"<p>Topic: <code>users.create</code> Creates <code>TaskUser</code> record for new users.</p> <p>Topic: <code>users.update</code> Updates <code>TaskUser</code> with new email/phone.</p> <p>Topic: <code>users.remove</code> Deletes <code>TaskUser</code> record.</p>"},{"location":"dupa/microservices/tasks/#published-events-future","title":"Published Events (Future)","text":"<p>Potential events for other services: - <code>tasks.create</code> - Notify assignee via Notifications service - <code>tasks.assign</code> - Send push notification - <code>tasks.complete</code> - Notify creator</p>"},{"location":"dupa/microservices/tasks/#data-filtering","title":"Data Filtering","text":"<p>List endpoint supports multiple filters:</p> <pre><code>interface TaskFilters {\n  status?: TASK_STATUS;       // Filter by status\n  priority?: TASK_PRIORITY;   // Filter by priority\n  assignedToId?: number;      // Filter by assignee\n  createdById?: number;       // Filter by creator\n  companyId?: number;         // Always filtered by user's company\n  page?: number;              // Pagination\n  limit?: number;\n}\n</code></pre> <p>Combined example: <pre><code>GET /tasks?status=IN_PROGRESS&amp;priority=HIGH&amp;assignedToId=5\n</code></pre></p>"},{"location":"dupa/microservices/tasks/#database-schema","title":"Database Schema","text":"<p>TaskUser: - Synced from Users service - Prevents cross-service database queries - Many tasks reference one user</p> <p>Task: - Many-to-1 with TaskUser (creator) - Many-to-1 with TaskUser (assignee) - Indexed by status, priority, assignedToId, companyId</p>"},{"location":"dupa/microservices/tasks/#testing","title":"Testing","text":"<p>Seed data includes sample tasks.</p>"},{"location":"dupa/microservices/tasks/#create-and-assign-task","title":"Create and Assign Task","text":"<pre><code># Login as admin\nADMIN_TOKEN=$(curl -s -X POST http://localhost:8000/auth/login \\\n  -d '{\"email\":\"alice.admin@acme.com\",\"password\":\"ChangeMe123!\"}' \\\n  -H \"Content-Type: application/json\" | jq -r '.accessToken')\n\n# Create task\nTASK=$(curl -s -X POST http://localhost:8000/tasks \\\n  -H \"Authorization: Bearer $ADMIN_TOKEN\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"title\": \"Deploy to production\",\n    \"description\": \"Deploy new features to prod environment\",\n    \"priority\": \"URGENT\",\n    \"assignedToId\": 2,\n    \"dueDate\": \"2024-12-31\"\n  }')\n\nTASK_ID=$(echo $TASK | jq -r '.id')\n\n# Update status\ncurl -X PATCH http://localhost:8000/tasks/$TASK_ID \\\n  -H \"Authorization: Bearer $ADMIN_TOKEN\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"status\": \"IN_PROGRESS\"}'\n\n# Get task\ncurl http://localhost:8000/tasks/$TASK_ID \\\n  -H \"Authorization: Bearer $ADMIN_TOKEN\"\n</code></pre>"},{"location":"dupa/microservices/tasks/#list-my-tasks","title":"List My Tasks","text":"<pre><code># Login as employee\nTOKEN=$(curl -s -X POST http://localhost:8000/auth/login \\\n  -d '{\"email\":\"eve.employee@globex.com\",\"password\":\"ChangeMe123!\"}' \\\n  -H \"Content-Type: application/json\" | jq -r '.accessToken')\n\n# Get my tasks\ncurl \"http://localhost:8000/tasks?assignedToId=3\" \\\n  -H \"Authorization: Bearer $TOKEN\"\n</code></pre>"},{"location":"dupa/microservices/tasks/#common-workflows","title":"Common Workflows","text":""},{"location":"dupa/microservices/tasks/#1-daily-task-list","title":"1. Daily Task List","text":"<p>Employee views tasks assigned to them: <pre><code>GET /tasks?assignedToId={userId}&amp;status=TODO&amp;status=IN_PROGRESS\n</code></pre></p>"},{"location":"dupa/microservices/tasks/#2-manager-oversight","title":"2. Manager Oversight","text":"<p>Manager views team's tasks: <pre><code>GET /tasks?status=IN_PROGRESS\n</code></pre> (Filtered by manager's teams on backend)</p>"},{"location":"dupa/microservices/tasks/#3-urgent-tasks-dashboard","title":"3. Urgent Tasks Dashboard","text":"<p>Admin sees all urgent tasks: <pre><code>GET /tasks?priority=URGENT\n</code></pre></p>"},{"location":"dupa/microservices/tasks/#4-overdue-tasks","title":"4. Overdue Tasks","text":"<p>Tasks past due date (frontend filters): <pre><code>GET /tasks?dueDate=lt:2024-01-15\n</code></pre></p>"},{"location":"dupa/microservices/tasks/#validation-rules","title":"Validation Rules","text":"<ul> <li>title: Required, 1-200 characters</li> <li>description: Optional, max 2000 characters</li> <li>status: Must be valid TASK_STATUS enum</li> <li>priority: Must be valid TASK_PRIORITY enum</li> <li>assignedToId: Must exist and be in same company</li> <li>dueDate: Must be valid ISO date, future date preferred</li> </ul>"},{"location":"dupa/microservices/tasks/#error-scenarios","title":"Error Scenarios","text":""},{"location":"dupa/microservices/tasks/#assign-to-non-existent-user","title":"Assign to Non-existent User","text":"<pre><code>POST /tasks {\"assignedToId\": 999}\n\u2192 404 Not Found: \"User not found\"\n</code></pre>"},{"location":"dupa/microservices/tasks/#cross-company-assignment","title":"Cross-Company Assignment","text":"<pre><code>POST /tasks {\"assignedToId\": 10} (different company)\n\u2192 403 Forbidden: \"Cannot assign task to user from different company\"\n</code></pre>"},{"location":"dupa/microservices/tasks/#unauthorized-update","title":"Unauthorized Update","text":"<pre><code>PATCH /tasks/5 (not your task, not admin)\n\u2192 403 Forbidden: \"Cannot modify this task\"\n</code></pre>"},{"location":"dupa/microservices/tasks/#dependencies","title":"Dependencies","text":"<ul> <li>@nestjs/common: Core framework</li> <li>@prisma/client: Database access</li> <li>kafkajs: Event consumption</li> <li>class-validator: DTO validation</li> </ul>"},{"location":"dupa/microservices/tasks/#performance-considerations","title":"Performance Considerations","text":"<ul> <li>Indexed queries on status, assignedToId, companyId</li> <li>Pagination prevents large result sets</li> <li>Eager loading avoided (N+1 problem)</li> </ul>"},{"location":"dupa/microservices/tasks/#future-enhancements","title":"Future Enhancements","text":"<ul> <li> Task comments/activity feed</li> <li> File attachments</li> <li> Task dependencies (blockers)</li> <li> Recurring tasks</li> <li> Task templates</li> <li> Time tracking integration</li> <li> Notifications on assignment/completion</li> <li> Task categories/tags</li> <li> Kanban board support</li> <li> Subtasks</li> </ul>"},{"location":"dupa/microservices/tasks/#related-documentation","title":"Related Documentation","text":"<ul> <li>Database Schema</li> <li>API Reference</li> <li>Microservices Overview</li> </ul>"},{"location":"dupa/microservices/users/","title":"Users Service","text":"<p>The Users service is the foundation of the platform, handling user accounts, companies, teams, and authentication.</p>"},{"location":"dupa/microservices/users/#responsibilities","title":"Responsibilities","text":"<ul> <li>User account management (CRUD)</li> <li>Company management</li> <li>Team management and hierarchy</li> <li>JWT authentication and authorization</li> <li>User lifecycle event publishing</li> </ul>"},{"location":"dupa/microservices/users/#port-database","title":"Port &amp; Database","text":"<ul> <li>HTTP Port: 3000</li> <li>Database: <code>hiver_users</code> (PostgreSQL)</li> <li>Health Endpoint: <code>/users-app/health</code></li> </ul>"},{"location":"dupa/microservices/users/#key-entities","title":"Key Entities","text":""},{"location":"dupa/microservices/users/#user","title":"User","text":"<p>Core entity representing a person in the system.</p> <p>Fields: - Personal: name, surname, email, phone, dateOfBirth - Work: title, role (ADMIN/MANAGER/EMPLOYEE) - Organization: companyId, teams[], bossId - Auth: password (hashed), accountStatus</p> <p>Roles: - <code>ADMIN</code>: Full system access, can manage all users - <code>MANAGER</code>: Team management, can manage subordinates - <code>EMPLOYEE</code>: Basic access, can manage own data</p>"},{"location":"dupa/microservices/users/#company","title":"Company","text":"<p>Organizations using the platform.</p> <p>Fields: - name, domain (optional) - users[], teams[]</p>"},{"location":"dupa/microservices/users/#team","title":"Team","text":"<p>Work units within a company.</p> <p>Fields: - name, companyId, leaderId - members[] (many-to-many with users)</p>"},{"location":"dupa/microservices/users/#api-endpoints","title":"API Endpoints","text":""},{"location":"dupa/microservices/users/#authentication","title":"Authentication","text":"<pre><code>POST   /auth/login          # Login with credentials\nPOST   /auth/refresh        # Refresh access token\nGET    /auth/me             # Get current user profile\n</code></pre>"},{"location":"dupa/microservices/users/#users","title":"Users","text":"<pre><code>GET    /users               # List users (paginated, searchable)\nPOST   /users               # Create user (Admin only)\nGET    /users/:id           # Get user by ID\nPATCH  /users/:id           # Update user\nDELETE /users/:id           # Delete user\n\nPOST   /users/register      # Register new user (Admin only)\nPATCH  /users/:id/complete-registration  # Complete first-time setup\n</code></pre>"},{"location":"dupa/microservices/users/#companies","title":"Companies","text":"<pre><code>GET    /companies           # List companies\nPOST   /companies           # Create company\nGET    /companies/:id       # Get company\nPATCH  /companies/:id       # Update company\nDELETE /companies/:id       # Delete company\n</code></pre>"},{"location":"dupa/microservices/users/#teams","title":"Teams","text":"<pre><code>GET    /teams               # List teams\nPOST   /teams               # Create team\nGET    /teams/:id           # Get team\nPATCH  /teams/:id           # Update team\nDELETE /teams/:id           # Delete team\n</code></pre>"},{"location":"dupa/microservices/users/#kafka-events","title":"Kafka Events","text":""},{"location":"dupa/microservices/users/#published-events","title":"Published Events","text":"<p>Topic: <code>users.create</code> <pre><code>{\n  id: number;\n  email: string;\n  phone?: string;\n  companyId: number;\n}\n</code></pre> Triggered when a new user is created.</p> <p>Topic: <code>users.update</code> <pre><code>{\n  id: number;\n  email?: string;\n  phone?: string;\n  companyId?: number;\n}\n</code></pre> Triggered when user info changes (email, phone, company).</p> <p>Topic: <code>users.remove</code> <pre><code>{\n  id: number;\n}\n</code></pre> Triggered when a user is deleted.</p>"},{"location":"dupa/microservices/users/#authentication-flow","title":"Authentication Flow","text":""},{"location":"dupa/microservices/users/#login","title":"Login","text":"<ol> <li>Client sends email + password</li> <li>Service validates credentials</li> <li>Generates JWT access token (1h expiry)</li> <li>Generates refresh token (7d expiry)</li> <li>Returns both tokens + user profile</li> </ol>"},{"location":"dupa/microservices/users/#jwt-structure","title":"JWT Structure","text":"<pre><code>{\n  sub: userId,          // Subject (user ID)\n  email: string,\n  role: USER_ROLE,\n  name: string,\n  surname: string,\n  phone: string | null,\n  title: string | null,\n  bossId: number | null,\n  companyId: number,\n  teamIds: number[],\n  teams: { id: number; name: string }[],\n  accountStatus: ACCOUNT_STATUS,\n  iat: timestamp,       // Issued at\n  exp: timestamp        // Expires at\n}\n</code></pre>"},{"location":"dupa/microservices/users/#token-validation","title":"Token Validation","text":"<p>Every protected endpoint: 1. Extracts JWT from <code>Authorization: Bearer {token}</code> header 2. Validates signature using <code>JWT_SECRET</code> 3. Checks expiration 4. Injects user info into request context</p>"},{"location":"dupa/microservices/users/#business-logic","title":"Business Logic","text":""},{"location":"dupa/microservices/users/#user-registration-flow","title":"User Registration Flow","text":"<ol> <li>Admin creates user via <code>/users/register</code></li> <li>Service generates temporary password</li> <li>Sends welcome email with temp password</li> <li>User logs in with temp password</li> <li>User completes registration (sets real password, name, etc.)</li> <li>Account becomes fully active</li> </ol>"},{"location":"dupa/microservices/users/#authorization-checks","title":"Authorization Checks","text":"<ul> <li>Resource Ownership: Users can only modify their own data</li> <li>Role-Based: Admins can modify any user in their company</li> <li>Team-Based: Managers can view/modify team members</li> </ul>"},{"location":"dupa/microservices/users/#data-isolation","title":"Data Isolation","text":"<ul> <li>Users can only see/manage users in their company</li> <li>Cross-company data access is prevented at query level</li> </ul>"},{"location":"dupa/microservices/users/#database-schema","title":"Database Schema","text":"<p>Key relationships: - User <code>belongsTo</code> Company - User <code>belongsToMany</code> Team (through UserTeam join table) - User <code>hasMany</code> User (boss/subordinate relationship) - Team <code>belongsTo</code> Company - Team <code>hasOne</code> User (leader)</p>"},{"location":"dupa/microservices/users/#common-operations","title":"Common Operations","text":""},{"location":"dupa/microservices/users/#search-users","title":"Search Users","text":"<p>Supports searching by: - Name (case-insensitive) - Surname (case-insensitive) - Email (case-insensitive)</p> <p>Combined with pagination: <pre><code>GET /users?search=john&amp;page=1&amp;limit=10\n</code></pre></p>"},{"location":"dupa/microservices/users/#pagination","title":"Pagination","text":"<p>All list endpoints support: - <code>page</code>: Page number (default: 1) - <code>limit</code>: Items per page (default: 10, max: 100)</p> <p>Returns: <pre><code>{\n  data: T[],\n  meta: {\n    total: number,\n    page: number,\n    limit: number,\n    totalPages: number\n  }\n}\n</code></pre></p>"},{"location":"dupa/microservices/users/#testing","title":"Testing","text":"<p>Seed data includes: - 2 companies (Acme Corp, Globex) - 4 teams (2 per company) - 3 users with different roles</p> <p>Test accounts: <pre><code>Admin:    alice.admin@acme.com     / ChangeMe123!\nManager:  martin.manager@acme.com  / ChangeMe123!\nEmployee: eve.employee@globex.com  / ChangeMe123!\n</code></pre></p>"},{"location":"dupa/microservices/users/#dependencies","title":"Dependencies","text":"<ul> <li>@nestjs/jwt: JWT token generation</li> <li>@nestjs/passport: Authentication strategies</li> <li>bcrypt: Password hashing</li> <li>passport-jwt: JWT validation strategy</li> </ul>"},{"location":"dupa/microservices/users/#related-documentation","title":"Related Documentation","text":"<ul> <li>Authentication Guide</li> <li>Database Schema</li> <li>API Reference</li> </ul>"},{"location":"infrastructure/aws/","title":"AWS Services","text":"<p>HiveR integrates with AWS services for notifications and potentially other cloud capabilities.</p>"},{"location":"infrastructure/aws/#aws-sns-simple-notification-service","title":"AWS SNS (Simple Notification Service)","text":"<p>AWS SNS handles email and push notification delivery for the HiveR system.</p>"},{"location":"infrastructure/aws/#use-cases","title":"Use Cases","text":"<p>Email Notifications: - Task assignments - Presence reminders - System alerts - Administrative notices</p> <p>Push Notifications: - Real-time task updates - Check-in confirmations - Urgent alerts - Team messages</p>"},{"location":"infrastructure/aws/#configuration","title":"Configuration","text":""},{"location":"infrastructure/aws/#topics","title":"Topics","text":"<ul> <li><code>hiver-emails</code> - Email notifications</li> <li><code>hiver-push</code> - Push notifications</li> <li><code>hiver-admin</code> - Admin alerts</li> </ul>"},{"location":"infrastructure/aws/#subscriptions","title":"Subscriptions","text":"<ul> <li>Email endpoints for users</li> <li>Mobile device endpoints (FCM/APNS)</li> <li>HTTP endpoints for webhooks</li> </ul>"},{"location":"infrastructure/aws/#integration","title":"Integration","text":"<p>Backend \u2192 SNS Flow: 1. Backend service creates notification event 2. Event published to Kafka 3. Notification service consumes event 4. Service calls SNS API 5. SNS delivers notification to endpoint</p>"},{"location":"infrastructure/aws/#iam-configuration","title":"IAM Configuration","text":"<p>Required permissions: - <code>sns:Publish</code> - Publish messages - <code>sns:CreateTopic</code> - Create topics - <code>sns:Subscribe</code> - Add subscriptions - <code>sns:ListTopics</code> - List available topics</p>"},{"location":"infrastructure/aws/#future-aws-services","title":"Future AWS Services","text":""},{"location":"infrastructure/aws/#amazon-s3","title":"Amazon S3","text":"<p>Potential Use: File storage for attachments, reports, and backups</p> <p>Planned Features: - Task attachments - Profile photos - Report storage - Database backups</p>"},{"location":"infrastructure/aws/#amazon-cloudwatch","title":"Amazon CloudWatch","text":"<p>Potential Use: Monitoring and logging</p> <p>Planned Features: - Application logs - Performance metrics - Custom dashboards - Alerts and alarms</p>"},{"location":"infrastructure/aws/#amazon-rds","title":"Amazon RDS","text":"<p>Potential Use: Managed PostgreSQL</p> <p>Benefits: - Automated backups - High availability - Read replicas - Automated patching</p>"},{"location":"infrastructure/aws/#amazon-ecseks","title":"Amazon ECS/EKS","text":"<p>Potential Use: Container orchestration</p> <p>Benefits: - Scalable microservices - Auto-scaling - Load balancing - Service discovery</p>"},{"location":"infrastructure/aws/#cost-optimization","title":"Cost Optimization","text":""},{"location":"infrastructure/aws/#sns-costs","title":"SNS Costs","text":"<ul> <li>Pay per request</li> <li>Free tier: 1,000 email notifications/month</li> <li>Optimize notification batching</li> <li>Monitor usage patterns</li> </ul>"},{"location":"infrastructure/aws/#general-strategies","title":"General Strategies","text":"<ul> <li>Use appropriate instance sizes</li> <li>Implement auto-scaling</li> <li>Monitor and optimize data transfer</li> <li>Use reserved instances for stable workloads</li> </ul>"},{"location":"infrastructure/aws/#security-best-practices","title":"Security Best Practices","text":"<ul> <li>Use IAM roles (not access keys)</li> <li>Enable encryption in transit</li> <li>Implement least privilege access</li> <li>Regular security audits</li> <li>Enable CloudTrail logging</li> </ul> <p>Related: Infrastructure Overview</p>"},{"location":"infrastructure/databases/","title":"Databases","text":"<p>HiveR uses PostgreSQL databases following the database-per-service pattern for data isolation and service independence.</p>"},{"location":"infrastructure/databases/#database-architecture","title":"Database Architecture","text":"<p>Each microservice has its own PostgreSQL database: - Main Database: User and company data - Presence Database: Presence records - Tasks Database: Task management</p>"},{"location":"infrastructure/databases/#main-database","title":"Main Database","text":""},{"location":"infrastructure/databases/#schema-overview","title":"Schema Overview","text":"<p>Users Table <pre><code>CREATE TABLE users (\n    id UUID PRIMARY KEY,\n    email VARCHAR(255) UNIQUE NOT NULL,\n    password_hash VARCHAR(255) NOT NULL,\n    first_name VARCHAR(100),\n    last_name VARCHAR(100),\n    company_id UUID REFERENCES companies(id),\n    role VARCHAR(50),\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n);\n</code></pre></p> <p>Companies Table <pre><code>CREATE TABLE companies (\n    id UUID PRIMARY KEY,\n    name VARCHAR(255) NOT NULL,\n    address TEXT,\n    contact_email VARCHAR(255),\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n);\n</code></pre></p>"},{"location":"infrastructure/databases/#presence-database","title":"Presence Database","text":""},{"location":"infrastructure/databases/#schema-overview_1","title":"Schema Overview","text":"<p>Presence Records Table <pre><code>CREATE TABLE presence_records (\n    id UUID PRIMARY KEY,\n    user_id UUID NOT NULL,\n    company_id UUID NOT NULL,\n    check_in_time TIMESTAMP NOT NULL,\n    check_out_time TIMESTAMP,\n    location VARCHAR(255),\n    device_id VARCHAR(100),\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n);\n</code></pre></p> <p>Presence Schedules Table <pre><code>CREATE TABLE presence_schedules (\n    id UUID PRIMARY KEY,\n    user_id UUID NOT NULL,\n    day_of_week INTEGER NOT NULL,\n    start_time TIME NOT NULL,\n    end_time TIME NOT NULL,\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n);\n</code></pre></p>"},{"location":"infrastructure/databases/#tasks-database","title":"Tasks Database","text":""},{"location":"infrastructure/databases/#schema-overview_2","title":"Schema Overview","text":"<p>Tasks Table <pre><code>CREATE TABLE tasks (\n    id UUID PRIMARY KEY,\n    title VARCHAR(255) NOT NULL,\n    description TEXT,\n    company_id UUID NOT NULL,\n    creator_id UUID NOT NULL,\n    priority VARCHAR(50),\n    status VARCHAR(50) DEFAULT 'pending',\n    due_date TIMESTAMP,\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n);\n</code></pre></p> <p>Task Assignments Table <pre><code>CREATE TABLE task_assignments (\n    id UUID PRIMARY KEY,\n    task_id UUID REFERENCES tasks(id),\n    user_id UUID NOT NULL,\n    assigned_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    completed_at TIMESTAMP\n);\n</code></pre></p>"},{"location":"infrastructure/databases/#database-management","title":"Database Management","text":""},{"location":"infrastructure/databases/#migrations","title":"Migrations","text":"<ul> <li>Schema versioning</li> <li>Migration scripts</li> <li>Rollback procedures</li> </ul>"},{"location":"infrastructure/databases/#backups","title":"Backups","text":"<ul> <li>Automated daily backups</li> <li>Point-in-time recovery</li> <li>Backup retention policy</li> <li>Disaster recovery procedures</li> </ul>"},{"location":"infrastructure/databases/#performance","title":"Performance","text":"<ul> <li>Index optimization</li> <li>Query performance monitoring</li> <li>Connection pooling</li> <li>Read replicas (if needed)</li> </ul>"},{"location":"infrastructure/databases/#configuration","title":"Configuration","text":""},{"location":"infrastructure/databases/#connection-settings","title":"Connection Settings","text":"<ul> <li>Connection pooling parameters</li> <li>Timeout configurations</li> <li>SSL/TLS settings</li> <li>Authentication methods</li> </ul>"},{"location":"infrastructure/databases/#monitoring","title":"Monitoring","text":"<ul> <li>Slow query logging</li> <li>Connection monitoring</li> <li>Storage usage tracking</li> <li>Performance metrics</li> </ul> <p>Related: Infrastructure Overview</p>"},{"location":"infrastructure/deployment/","title":"Deployment","text":"<p>Deployment procedures and best practices for the HiveR system.</p>"},{"location":"infrastructure/deployment/#deployment-strategy","title":"Deployment Strategy","text":""},{"location":"infrastructure/deployment/#environments","title":"Environments","text":"<p>Development - Local development environment - Feature branches - Rapid iteration</p> <p>Staging - Pre-production testing - Integration testing - Performance testing - User acceptance testing</p> <p>Production - Live system - High availability - Monitoring and alerting - Backup and recovery</p>"},{"location":"infrastructure/deployment/#deployment-process","title":"Deployment Process","text":""},{"location":"infrastructure/deployment/#microservices-deployment","title":"Microservices Deployment","text":"<p>Build: 1. Run tests 2. Build Docker images 3. Tag with version 4. Push to container registry</p> <p>Deploy: 1. Pull latest image 2. Update environment configuration 3. Deploy to orchestration platform 4. Verify health checks 5. Monitor for issues</p>"},{"location":"infrastructure/deployment/#database-migrations","title":"Database Migrations","text":"<p>Process: 1. Test migration on staging 2. Create database backup 3. Run migration scripts 4. Verify schema changes 5. Update application 6. Monitor for issues</p> <p>Rollback Plan: - Keep previous version running - Have rollback scripts ready - Test rollback procedure - Document recovery steps</p>"},{"location":"infrastructure/deployment/#cicd-pipeline","title":"CI/CD Pipeline","text":""},{"location":"infrastructure/deployment/#continuous-integration","title":"Continuous Integration","text":"<ul> <li>Automated testing on PR</li> <li>Code quality checks</li> <li>Security scanning</li> <li>Build verification</li> </ul>"},{"location":"infrastructure/deployment/#continuous-deployment","title":"Continuous Deployment","text":"<ul> <li>Automated deployment to staging</li> <li>Manual approval for production</li> <li>Automated rollback on failure</li> <li>Deployment notifications</li> </ul>"},{"location":"infrastructure/deployment/#infrastructure-as-code","title":"Infrastructure as Code","text":"<p>(To be implemented)</p> <p>Planned Tools: - Terraform for infrastructure - Docker for containerization - Kubernetes/ECS for orchestration - Ansible for configuration</p>"},{"location":"infrastructure/deployment/#monitoring","title":"Monitoring","text":""},{"location":"infrastructure/deployment/#health-checks","title":"Health Checks","text":"<ul> <li>Service availability</li> <li>Database connectivity</li> <li>Kafka connectivity</li> <li>External service status</li> </ul>"},{"location":"infrastructure/deployment/#metrics","title":"Metrics","text":"<ul> <li>Response times</li> <li>Error rates</li> <li>Throughput</li> <li>Resource utilization</li> </ul>"},{"location":"infrastructure/deployment/#alerts","title":"Alerts","text":"<ul> <li>Service down</li> <li>High error rate</li> <li>Performance degradation</li> <li>Capacity thresholds</li> </ul>"},{"location":"infrastructure/deployment/#rollback-procedures","title":"Rollback Procedures","text":""},{"location":"infrastructure/deployment/#application-rollback","title":"Application Rollback","text":"<ol> <li>Identify the issue</li> <li>Stop new deployments</li> <li>Deploy previous version</li> <li>Verify system stability</li> <li>Investigate root cause</li> </ol>"},{"location":"infrastructure/deployment/#database-rollback","title":"Database Rollback","text":"<ol> <li>Stop application writes</li> <li>Restore from backup</li> <li>Apply rollback migration</li> <li>Verify data integrity</li> <li>Resume normal operations</li> </ol>"},{"location":"infrastructure/deployment/#best-practices","title":"Best Practices","text":""},{"location":"infrastructure/deployment/#pre-deployment","title":"Pre-Deployment","text":"<ul> <li>Review changes thoroughly</li> <li>Test in staging environment</li> <li>Prepare rollback plan</li> <li>Schedule maintenance window</li> <li>Notify stakeholders</li> </ul>"},{"location":"infrastructure/deployment/#during-deployment","title":"During Deployment","text":"<ul> <li>Monitor metrics closely</li> <li>Follow deployment checklist</li> <li>Have team available</li> <li>Document any issues</li> <li>Keep communication open</li> </ul>"},{"location":"infrastructure/deployment/#post-deployment","title":"Post-Deployment","text":"<ul> <li>Verify functionality</li> <li>Check error logs</li> <li>Monitor performance</li> <li>Gather feedback</li> <li>Document lessons learned</li> </ul>"},{"location":"infrastructure/deployment/#disaster-recovery","title":"Disaster Recovery","text":""},{"location":"infrastructure/deployment/#backup-strategy","title":"Backup Strategy","text":"<ul> <li>Daily database backups</li> <li>Configuration backups</li> <li>Code repository backups</li> <li>Retention policy: 30 days</li> </ul>"},{"location":"infrastructure/deployment/#recovery-procedures","title":"Recovery Procedures","text":"<ul> <li>Restore from backup</li> <li>Rebuild infrastructure</li> <li>Verify data integrity</li> <li>Resume operations</li> <li>Post-incident review</li> </ul> <p>Related: Infrastructure Overview</p>"},{"location":"infrastructure/overview/","title":"Infrastructure Overview","text":"<p>The HiveR infrastructure is designed for scalability, reliability, and maintainability using cloud services and modern DevOps practices.</p>"},{"location":"infrastructure/overview/#architecture-components","title":"Architecture Components","text":""},{"location":"infrastructure/overview/#compute","title":"Compute","text":"<ul> <li>Microservices hosted in containers</li> <li>Scalable compute instances</li> <li>Load balancing</li> </ul>"},{"location":"infrastructure/overview/#data-storage","title":"Data Storage","text":"<ul> <li>PostgreSQL databases (one per service)</li> <li>Database backups and replication</li> <li>Cache layer (Redis - TBD)</li> </ul>"},{"location":"infrastructure/overview/#messaging","title":"Messaging","text":"<ul> <li>Apache Kafka cluster</li> <li>Message persistence</li> <li>Topic configuration</li> </ul>"},{"location":"infrastructure/overview/#external-services","title":"External Services","text":"<ul> <li>AWS SNS for notifications</li> <li>S3 for file storage (TBD)</li> <li>CloudWatch for monitoring (TBD)</li> </ul>"},{"location":"infrastructure/overview/#pages","title":"Pages","text":"<ul> <li>Databases - Database schemas and management</li> <li>AWS Services - AWS service integration</li> <li>Deployment - Deployment procedures</li> </ul>"},{"location":"infrastructure/overview/#infrastructure-as-code","title":"Infrastructure as Code","text":"<p>(To be implemented - Terraform, CloudFormation, etc.)</p>"},{"location":"infrastructure/overview/#monitoring-observability","title":"Monitoring &amp; Observability","text":""},{"location":"infrastructure/overview/#metrics","title":"Metrics","text":"<ul> <li>Service health checks</li> <li>Performance metrics</li> <li>Resource utilization</li> <li>Business metrics</li> </ul>"},{"location":"infrastructure/overview/#logging","title":"Logging","text":"<ul> <li>Centralized logging</li> <li>Log aggregation</li> <li>Log analysis</li> <li>Audit trails</li> </ul>"},{"location":"infrastructure/overview/#alerting","title":"Alerting","text":"<ul> <li>System alerts</li> <li>Performance thresholds</li> <li>Error notifications</li> <li>On-call procedures</li> </ul>"},{"location":"infrastructure/overview/#security","title":"Security","text":""},{"location":"infrastructure/overview/#network-security","title":"Network Security","text":"<ul> <li>VPC configuration</li> <li>Security groups</li> <li>Network segmentation</li> <li>DDoS protection</li> </ul>"},{"location":"infrastructure/overview/#data-security","title":"Data Security","text":"<ul> <li>Encryption at rest</li> <li>Encryption in transit</li> <li>Key management</li> <li>Access control</li> </ul>"},{"location":"infrastructure/overview/#compliance","title":"Compliance","text":"<ul> <li>GDPR compliance</li> <li>Data retention policies</li> <li>Privacy controls</li> <li>Audit capabilities</li> </ul> <p>Explore specific infrastructure components for detailed documentation.</p>"},{"location":"mobile/features/","title":"Mobile App Features","text":"<p>Detailed documentation of mobile app features and user flows.</p>"},{"location":"mobile/features/#presence-check-in","title":"Presence Check-In","text":""},{"location":"mobile/features/#manual-check-in","title":"Manual Check-In","text":"<ol> <li>User opens the app</li> <li>Taps \"Check In\" button</li> <li>Location verification (optional)</li> <li>Confirmation displayed</li> <li>Backend records presence</li> </ol>"},{"location":"mobile/features/#automatic-check-in-via-iot","title":"Automatic Check-In via IoT","text":"<ol> <li>User approaches office with IoT beacon</li> <li>Device detects user's phone</li> <li>App prompts for check-in confirmation</li> <li>User confirms or auto-confirms (based on settings)</li> <li>Presence recorded</li> </ol>"},{"location":"mobile/features/#dashboard","title":"Dashboard","text":"<p>The main dashboard displays: - Current presence status (checked in/out) - Today's schedule - Upcoming tasks - Recent notifications - Quick action buttons</p>"},{"location":"mobile/features/#presence-history","title":"Presence History","text":"<p>View historical presence data: - Calendar view of past check-ins - Daily/weekly/monthly summaries - Presence statistics - Export functionality</p>"},{"location":"mobile/features/#task-management","title":"Task Management","text":"<p>Employees can: - View assigned tasks - Update task status - Add comments - Set task reminders - Mark tasks as complete</p>"},{"location":"mobile/features/#notifications","title":"Notifications","text":"<p>Types of notifications: - Task assignments - Presence reminders - Schedule changes - System announcements - Direct messages from managers</p> <p>Notification settings: - Enable/disable push notifications - Notification sound and vibration - Quiet hours</p>"},{"location":"mobile/features/#profile-settings","title":"Profile &amp; Settings","text":"<p>Profile Section: - Personal information - Contact details - Profile photo - Company affiliation</p> <p>Settings: - Notification preferences - IoT device management - Auto check-in settings - Language and region - Privacy settings</p>"},{"location":"mobile/features/#offline-functionality","title":"Offline Functionality","text":"<p>The app supports offline mode: - View cached presence history - Queue check-in/out actions - Sync when connection restored - Offline task viewing</p> <p>Next: IoT Integration</p>"},{"location":"mobile/iot/","title":"IoT Integration","text":"<p>The HiveR mobile app integrates with IoT devices to enable automated presence tracking and seamless office interactions.</p>"},{"location":"mobile/iot/#supported-iot-devices","title":"Supported IoT Devices","text":""},{"location":"mobile/iot/#bluetooth-beacons","title":"Bluetooth Beacons","text":"<ul> <li>Office entrance beacons</li> <li>Department-specific beacons</li> <li>Meeting room beacons</li> </ul>"},{"location":"mobile/iot/#nfc-tags","title":"NFC Tags","text":"<ul> <li>Check-in terminals</li> <li>Door access points</li> <li>Desk stations</li> </ul>"},{"location":"mobile/iot/#qr-codes","title":"QR Codes","text":"<ul> <li>Quick check-in posters</li> <li>Visitor management</li> <li>Equipment check-out</li> </ul>"},{"location":"mobile/iot/#communication-flow","title":"Communication Flow","text":""},{"location":"mobile/iot/#device-discovery","title":"Device Discovery","text":"<ol> <li>App scans for nearby IoT devices</li> <li>Matches device IDs with registered office devices</li> <li>Establishes secure connection</li> <li>Ready for interaction</li> </ol>"},{"location":"mobile/iot/#check-in-process","title":"Check-In Process","text":"<ol> <li>IoT device detects employee's mobile app</li> <li>Device sends check-in prompt to app</li> <li>App displays confirmation request</li> <li>Employee confirms (or auto-confirms)</li> <li>App sends check-in event to backend</li> <li>Presence recorded in system</li> </ol>"},{"location":"mobile/iot/#device-response","title":"Device Response","text":"<ol> <li>Employee's action triggers device response</li> <li>Visual/audio feedback from IoT device</li> <li>Backend confirms action</li> <li>Mobile app displays confirmation</li> </ol>"},{"location":"mobile/iot/#security","title":"Security","text":""},{"location":"mobile/iot/#authentication","title":"Authentication","text":"<ul> <li>Device-to-app authentication via secure tokens</li> <li>Encrypted communication channels</li> <li>Regular security key rotation</li> </ul>"},{"location":"mobile/iot/#privacy","title":"Privacy","text":"<ul> <li>Location data handling</li> <li>Bluetooth permission management</li> <li>User consent for device tracking</li> </ul>"},{"location":"mobile/iot/#device-management","title":"Device Management","text":""},{"location":"mobile/iot/#pairing-devices","title":"Pairing Devices","text":"<ol> <li>Admin registers IoT device in system</li> <li>Device receives unique identifier</li> <li>Employees can discover and pair with device</li> <li>Permissions set based on employee role</li> </ol>"},{"location":"mobile/iot/#trusted-devices","title":"Trusted Devices","text":"<ul> <li>Save frequently used devices</li> <li>Auto-connect to trusted devices</li> <li>Manage trusted device list</li> </ul>"},{"location":"mobile/iot/#configuration","title":"Configuration","text":""},{"location":"mobile/iot/#app-settings","title":"App Settings","text":"<ul> <li>Enable/disable IoT features</li> <li>Bluetooth/NFC permissions</li> <li>Auto check-in on device detection</li> <li>Preferred devices</li> </ul>"},{"location":"mobile/iot/#backend-configuration","title":"Backend Configuration","text":"<ul> <li>Register office IoT devices</li> <li>Set device locations</li> <li>Configure check-in zones</li> <li>Device-specific rules</li> </ul>"},{"location":"mobile/iot/#troubleshooting","title":"Troubleshooting","text":"<p>Device Not Detected: - Check Bluetooth/NFC is enabled - Ensure device is in range - Verify device is registered in system</p> <p>Failed Check-In: - Check network connectivity - Verify device battery - Ensure app has proper permissions</p> <p>Multiple Devices Detected: - App prioritizes closest/strongest signal - User can manually select device - Trusted device takes precedence</p> <p>Return to: Mobile Overview</p>"},{"location":"mobile/overview/","title":"Mobile App Overview","text":"<p>The HiveR mobile application is the primary interface for employees to manage their presence, interact with IoT devices, and stay connected with their workplace.</p>"},{"location":"mobile/overview/#target-users","title":"Target Users","text":"<p>Employees: Registered employees who need to track their in-office presence and manage work-related tasks.</p>"},{"location":"mobile/overview/#key-features","title":"Key Features","text":""},{"location":"mobile/overview/#presence-management","title":"Presence Management","text":"<ul> <li>Quick check-in/check-out</li> <li>IoT device integration for automated presence</li> <li>Presence history view</li> <li>Schedule overview</li> </ul>"},{"location":"mobile/overview/#iot-integration","title":"IoT Integration","text":"<ul> <li>Discover nearby IoT devices</li> <li>Automated check-in via IoT prompts</li> <li>Device pairing and management</li> </ul>"},{"location":"mobile/overview/#notifications","title":"Notifications","text":"<ul> <li>Push notifications for important events</li> <li>Task assignments and updates</li> <li>Presence reminders</li> </ul>"},{"location":"mobile/overview/#profile-management","title":"Profile Management","text":"<ul> <li>View and edit profile</li> <li>Manage notification preferences</li> <li>Access company information</li> </ul>"},{"location":"mobile/overview/#technical-stack","title":"Technical Stack","text":"<p>(To be determined - React Native, Flutter, Native, etc.)</p>"},{"location":"mobile/overview/#pages","title":"Pages","text":"<ul> <li>Features - Detailed feature documentation</li> <li>IoT Integration - IoT device communication</li> </ul> <p>Coming soon: Detailed technical documentation and setup guides.</p>"},{"location":"webapp/admin/","title":"Admin Panel","text":"<p>Administrative features available to company owners for system configuration and management.</p>"},{"location":"webapp/admin/#user-administration","title":"User Administration","text":""},{"location":"webapp/admin/#user-management","title":"User Management","text":"<ul> <li>Create new users</li> <li>Edit user profiles</li> <li>Assign roles and permissions</li> <li>Deactivate/reactivate users</li> <li>Bulk user operations</li> <li>Import users from CSV</li> </ul>"},{"location":"webapp/admin/#role-management","title":"Role Management","text":"<ul> <li>Define custom roles</li> <li>Set role permissions</li> <li>Assign roles to users</li> <li>Role hierarchy</li> </ul>"},{"location":"webapp/admin/#access-control","title":"Access Control","text":"<ul> <li>Permission management</li> <li>Feature toggles</li> <li>API access control</li> <li>Security policies</li> </ul>"},{"location":"webapp/admin/#company-settings","title":"Company Settings","text":""},{"location":"webapp/admin/#company-profile","title":"Company Profile","text":"<ul> <li>Company information</li> <li>Logo and branding</li> <li>Contact details</li> <li>Billing information</li> </ul>"},{"location":"webapp/admin/#business-configuration","title":"Business Configuration","text":"<ul> <li>Work hours and schedules</li> <li>Holidays and exceptions</li> <li>Departments and teams</li> <li>Office locations</li> </ul>"},{"location":"webapp/admin/#iot-device-management","title":"IoT Device Management","text":"<ul> <li>Register new devices</li> <li>Configure device settings</li> <li>Set device locations</li> <li>Monitor device status</li> <li>Decommission devices</li> </ul>"},{"location":"webapp/admin/#system-configuration","title":"System Configuration","text":""},{"location":"webapp/admin/#integration-settings","title":"Integration Settings","text":"<ul> <li>AWS SNS configuration</li> <li>Email service setup</li> <li>External API integrations</li> <li>Webhook configuration</li> </ul>"},{"location":"webapp/admin/#notification-templates","title":"Notification Templates","text":"<ul> <li>Email templates</li> <li>Push notification messages</li> <li>SMS templates (if applicable)</li> <li>Template variables</li> </ul>"},{"location":"webapp/admin/#security-settings","title":"Security Settings","text":"<ul> <li>Password policies</li> <li>Two-factor authentication</li> <li>Session timeout</li> <li>IP whitelisting</li> </ul>"},{"location":"webapp/admin/#analytics-reporting","title":"Analytics &amp; Reporting","text":""},{"location":"webapp/admin/#system-analytics","title":"System Analytics","text":"<ul> <li>User activity metrics</li> <li>System performance</li> <li>Feature usage statistics</li> <li>API usage monitoring</li> </ul>"},{"location":"webapp/admin/#company-reports","title":"Company Reports","text":"<ul> <li>Company-wide presence statistics</li> <li>Task completion metrics</li> <li>User engagement</li> <li>Cost analysis</li> </ul>"},{"location":"webapp/admin/#audit-logs","title":"Audit Logs","text":"<ul> <li>User activity logs</li> <li>System changes</li> <li>Security events</li> <li>Data access logs</li> </ul>"},{"location":"webapp/admin/#advanced-features","title":"Advanced Features","text":""},{"location":"webapp/admin/#data-management","title":"Data Management","text":"<ul> <li>Data export</li> <li>Backup configuration</li> <li>Data retention policies</li> <li>GDPR compliance tools</li> </ul>"},{"location":"webapp/admin/#system-maintenance","title":"System Maintenance","text":"<ul> <li>System health monitoring</li> <li>Performance metrics</li> <li>Error logs</li> <li>Service status</li> </ul>"},{"location":"webapp/admin/#customization","title":"Customization","text":"<ul> <li>Custom fields</li> <li>Workflow configuration</li> <li>Branding customization</li> <li>Feature flags</li> </ul> <p>Return to: Web App Overview</p>"},{"location":"webapp/management/","title":"Management Features","text":"<p>Features available to managers for workforce and task management.</p>"},{"location":"webapp/management/#dashboard","title":"Dashboard","text":"<p>The manager dashboard provides: - Real-time team presence overview - Today's task summary - Recent activities - Alerts and notifications - Quick actions</p>"},{"location":"webapp/management/#presence-management","title":"Presence Management","text":""},{"location":"webapp/management/#team-presence-view","title":"Team Presence View","text":"<ul> <li>List of all team members</li> <li>Current status (in office / remote / absent)</li> <li>Check-in/out times</li> <li>Schedule vs actual comparison</li> </ul>"},{"location":"webapp/management/#presence-reports","title":"Presence Reports","text":"<ul> <li>Daily/weekly/monthly summaries</li> <li>Attendance statistics</li> <li>Late arrival tracking</li> <li>Early departure monitoring</li> <li>Absence patterns</li> </ul>"},{"location":"webapp/management/#schedule-management","title":"Schedule Management","text":"<ul> <li>View team schedules</li> <li>Approve schedule change requests</li> <li>Set expected work hours</li> <li>Manage shift patterns</li> </ul>"},{"location":"webapp/management/#task-management","title":"Task Management","text":""},{"location":"webapp/management/#create-tasks","title":"Create Tasks","text":"<ul> <li>Task title and description</li> <li>Assign to team members</li> <li>Set priority and deadline</li> <li>Add tags and categories</li> <li>Attach files and links</li> </ul>"},{"location":"webapp/management/#task-overview","title":"Task Overview","text":"<ul> <li>Active tasks by status</li> <li>Tasks by team member</li> <li>Overdue task alerts</li> <li>Task completion trends</li> </ul>"},{"location":"webapp/management/#task-assignment","title":"Task Assignment","text":"<ul> <li>Assign to individual or team</li> <li>Reassign tasks</li> <li>Bulk assignment</li> <li>Load balancing view</li> </ul>"},{"location":"webapp/management/#task-tracking","title":"Task Tracking","text":"<ul> <li>Update task status</li> <li>Add comments and notes</li> <li>Track time spent</li> <li>View task history</li> </ul>"},{"location":"webapp/management/#team-management","title":"Team Management","text":""},{"location":"webapp/management/#team-members","title":"Team Members","text":"<ul> <li>View team roster</li> <li>Contact information</li> <li>Role and responsibilities</li> <li>Performance metrics</li> </ul>"},{"location":"webapp/management/#communication","title":"Communication","text":"<ul> <li>Send notifications to team</li> <li>Broadcast messages</li> <li>Direct messaging</li> <li>Announcement posting</li> </ul>"},{"location":"webapp/management/#reports","title":"Reports","text":""},{"location":"webapp/management/#presence-reports_1","title":"Presence Reports","text":"<ul> <li>Export attendance data</li> <li>Overtime calculation</li> <li>Absence summary</li> <li>Trend analysis</li> </ul>"},{"location":"webapp/management/#task-reports","title":"Task Reports","text":"<ul> <li>Task completion rates</li> <li>Average completion time</li> <li>Productivity metrics</li> <li>Workload distribution</li> </ul>"},{"location":"webapp/management/#custom-reports","title":"Custom Reports","text":"<ul> <li>Build custom queries</li> <li>Save report templates</li> <li>Schedule automated reports</li> <li>Export in multiple formats</li> </ul> <p>Next: Admin Panel</p>"},{"location":"webapp/overview/","title":"Web App Overview","text":"<p>The HiveR web application provides a comprehensive management interface for managers and administrators to oversee workforce operations, manage tasks, and configure the system.</p>"},{"location":"webapp/overview/#target-users","title":"Target Users","text":"<p>Managers: Manage their teams, monitor presence, assign tasks, and view reports.</p> <p>Admins: Company owners with full system administration capabilities, including user management, system configuration, and advanced reporting.</p>"},{"location":"webapp/overview/#key-features","title":"Key Features","text":""},{"location":"webapp/overview/#workforce-management","title":"Workforce Management","text":"<ul> <li>View team presence in real-time</li> <li>Monitor check-in/out patterns</li> <li>Manage employee schedules</li> <li>Generate presence reports</li> </ul>"},{"location":"webapp/overview/#task-management","title":"Task Management","text":"<ul> <li>Create and assign tasks</li> <li>Track task progress</li> <li>Set deadlines and priorities</li> <li>View team workload</li> </ul>"},{"location":"webapp/overview/#user-administration-admin-only","title":"User Administration (Admin Only)","text":"<ul> <li>Add/remove users</li> <li>Assign roles and permissions</li> <li>Manage company settings</li> <li>Configure integrations</li> </ul>"},{"location":"webapp/overview/#reporting-analytics","title":"Reporting &amp; Analytics","text":"<ul> <li>Presence analytics</li> <li>Task completion metrics</li> <li>Team performance dashboards</li> <li>Export reports</li> </ul>"},{"location":"webapp/overview/#technical-stack","title":"Technical Stack","text":"<p>(To be determined - React, Vue, Angular, etc.)</p>"},{"location":"webapp/overview/#pages","title":"Pages","text":"<ul> <li>Management Features - Manager capabilities</li> <li>Admin Panel - Administration features</li> </ul> <p>Coming soon: Detailed technical documentation and setup guides.</p>"}]}